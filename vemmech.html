<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>vemmech: Mechanics for general grids using the virtual element method &mdash; The Matlab Reservoir Simulation Toolbox 2019b documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="wellpaths: Generation of wells using general curves" href="wellpaths.html" />
    <link rel="prev" title="vem: Virtual element method on general grids" href="vem.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> The Matlab Reservoir Simulation Toolbox
            <img src="_static/mrstlogo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2019b
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="core.html">Core functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="ad-core.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">ad-core</span></code>: Automatic Differentiation Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="ad-props.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">ad-props</span></code>: PVT, fluid models and other properties for the AD-solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="ad-blackoil.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">ad-blackoil</span></code>: Black-oil solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="ad-eor.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">ad-eor</span></code>: Enhanced oil recovery solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="ad-mechanics.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">ad-mechanics</span></code>: Coupled flow and mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="adjoint.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">adjoint</span></code>: Two-phase, incompressible adjoint solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="agglom.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">agglom</span></code>: Flow and property-based coarse-grid generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="blackoil-sequential.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">blackoil-sequential</span></code>: Sequential implicit black-oil solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="book.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">book</span></code>: Book examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="coarsegrid.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">coarsegrid</span></code>: Generation of coarse grids</a></li>
<li class="toctree-l1"><a class="reference internal" href="compositional.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">compositional</span></code>: Equation-of-state compositional solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="co2lab.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">co2lab</span></code>: Numerical CO<sub>2</sub> laboratory</a></li>
<li class="toctree-l1"><a class="reference internal" href="deckformat.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">deckformat</span></code>: Reading and conversion of input decks</a></li>
<li class="toctree-l1"><a class="reference internal" href="dfm.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">dfm</span></code>: Discrete fracture matrix implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="dg.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">dg</span></code>: Discontinous Galerkin discretizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="diagnostics.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">diagnostics</span></code>: Flow diagnostics functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="dual_porosity.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">dual-porosity</span></code>: Dual porosity/permeability model for fractures</a></li>
<li class="toctree-l1"><a class="reference internal" href="fvbiot.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">fvbiot</span></code>: Consistent finite-volume discretizations for poroelasticity</a></li>
<li class="toctree-l1"><a class="reference internal" href="geochemistry.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">geochemistry</span></code>: Surface geochemistry</a></li>
<li class="toctree-l1"><a class="reference internal" href="heterogeneity.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">heterogeneity</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="hfm.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">hfm</span></code>: Hierarchical and embedded fractures</a></li>
<li class="toctree-l1"><a class="reference internal" href="incomp.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">incomp</span></code>: Solvers for incompressible flow and transport</a></li>
<li class="toctree-l1"><a class="reference internal" href="libgeometry.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">libgeometry</span></code>:</a></li>
<li class="toctree-l1"><a class="reference internal" href="linearsolvers.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">linearsolvers</span></code>:</a></li>
<li class="toctree-l1"><a class="reference internal" href="matlab_bgl.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">matlab_bgl</span></code>:</a></li>
<li class="toctree-l1"><a class="reference internal" href="mimetic.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">mimetic</span></code>: Mimetic solvers for pressure problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="mpfa.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">mpfa</span></code>: Multi-point flux approximation solvers for pressure</a></li>
<li class="toctree-l1"><a class="reference internal" href="mrst_api.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">mrst_api</span></code>: API for writing C/C++ for MRST</a></li>
<li class="toctree-l1"><a class="reference internal" href="mrst-gui.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">mrst-gui</span></code>: Graphical user-interfaces for MRST</a></li>
<li class="toctree-l1"><a class="reference internal" href="msfvm.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">msfvm</span></code>: Multiscale Finite-Volume method for pressure</a></li>
<li class="toctree-l1"><a class="reference internal" href="msmfem.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">msmfem</span></code>: Multiscale Mixed Finite-Element method for pressure</a></li>
<li class="toctree-l1"><a class="reference internal" href="msrsb.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">msrsb</span></code>: Multiscale Restriction-Smoothed Basis method for pressure</a></li>
<li class="toctree-l1"><a class="reference internal" href="nwm.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">nwm</span></code>: Near Wellbore Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="opm_gridprocessing.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">opm_gridprocessing</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="optimization.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">optimization</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="re-mpfa.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">re-mpfa</span></code>: Richards’ equation with multi-point flux</a></li>
<li class="toctree-l1"><a class="reference internal" href="solvent.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">solvent</span></code>: Solvent solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="spe10.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">spe10</span></code>: Access to the SPE10 benchmark case</a></li>
<li class="toctree-l1"><a class="reference internal" href="steady-state.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">steady-state</span></code> Steady-state upscaling of functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="streamlines.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">streamlines</span></code>: Compute streamlines</a></li>
<li class="toctree-l1"><a class="reference internal" href="triangle.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">triangle</span></code>: Triangular grids</a></li>
<li class="toctree-l1"><a class="reference internal" href="upscaling.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">upscaling</span></code>: Upscaling of reservoir problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="vem.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">vem</span></code>: Virtual element method on general grids</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">vemmech</span></code>: Mechanics for general grids using the virtual element method</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#compaction-test-case-in-2d">Compaction test case in 2D</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#define-the-fluid-and-rock-parameters-and-set-up-the-grid">Define the fluid and rock parameters and set up the grid.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup-the-loads-and-the-boundary-conditions">Setup the loads and the boundary conditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#assemble-and-solve-the-system">Assemble and solve the system</a></li>
<li class="toctree-l4"><a class="reference internal" href="#computation-of-the-analytical-solution">Computation of the analytical solution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#comparison-plots">Comparison plots</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#compaction-test-case-3d">Compaction test case 3D</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#load-required-modules">Load required modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">Define the fluid and rock parameters and set up the grid.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Setup the loads and the boundary conditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">Assemble and solve the system</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compute-the-analytical-solution">Compute  the analytical solution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">Comparison plots</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#linear-elasticity-on-complex-grid">Linear Elasticity on Complex Grid</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#set-up-the-rock-parameters-and-the-grid">Set up the rock parameters and the grid</a></li>
<li class="toctree-l4"><a class="reference internal" href="#we-assemble-and-solve-the-equations">We assemble and solve the equations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#we-plot-the-results">We plot the results</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-short-example-solving-linear-elasticity-on-a-complex-grids">A short example solving linear elasticity on a complex grids</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">Load required modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-parameters">Define parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#make-a-mixed-type-of-grid">make a mixed type of grid</a></li>
<li class="toctree-l4"><a class="reference internal" href="#find-sides-of-domain">Find sides of domain</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-the-loading-term">Set up the loading term</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-the-displacement-boundary-condtions">Set up the displacement boundary condtions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-the-force-boundary-conditions">Set up the force boundary conditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-the-rock-parameters">Define the rock parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">Assemble and solve the system</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plot-displacement-in-y-direction">Plot displacement in y direction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plot-the-displacement-in-x-direction">Plot the displacement in x direction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plot-the-deformed-grid">plot the deformed grid</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calculate-and-plot-the-divergence">Calculate and plot the divergence</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calulate-the-stress-and-strain">Calulate the stress and strain</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#example-using-three-layers-with-different-parameters-in-each-layer">Example using three layers with different parameters in each layer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id7">Set up the rock parameters and the grid</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">We assemble and solve the equations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">We plot the results</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#example-of-poro-elastic-problem">Example of poro-elastic problem</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#define-the-grid-and-rock-parameters">Define the grid and rock parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-gravity-as-the-loading-term">Set up gravity as the loading term</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-the-displacement-boundary-conditions">Set up the displacement boundary conditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">Set up the force boundary conditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">Assemble and solve the system</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-the-parameters-for-the-flow-part">Set up the parameters for the flow part</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-matrix-for-mechanics-and-flow">Set up matrix for mechanics and flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#time-loop">Time loop</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wellpaths.html"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">wellpaths</span></code>: Generation of wells using general curves</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">The Matlab Reservoir Simulation Toolbox</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li><code class="xref mat mat-func docutils literal notranslate"><span class="pre">vemmech</span></code>: Mechanics for general grids using the virtual element method</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/vemmech.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="vemmech-mechanics-for-general-grids-using-the-virtual-element-method">
<h1><code class="xref mat mat-func docutils literal notranslate"><span class="pre">vemmech</span></code>: Mechanics for general grids using the virtual element method<a class="headerlink" href="#vemmech-mechanics-for-general-grids-using-the-virtual-element-method" title="Permalink to this headline"></a></h1>
<p>Geomechanics with the Virtual Element Method</p>
<p>The virtual element method (VEM) is a generalization of the finite element method to very general pologonal and polyhedral grids. The method takes inspiration from mimetic methods (see the ‘mimetic’ module) and is designed to fulfill the patch test, i.e., reproduce exact solutions for displacements that vary linearly in space (strain solutions).</p>
<p>The module contains a preliminary implementation of VEM for linear elasticity and poro eleasticity, and includes several examples with grids combining tetrahedal, hexahedral, and general polygonal elements. The tutorial examples do not offer much explaination or discussion of results, and the computational routines are not yet fully documented. Despite this, we have decided to publish the module ahead of time after several people have asked us to do so.</p>
<span class="target" id="module-vemmech.utils"></span><dl class="mat script">
<dt class="sig sig-object mat" id="vemmech.utils.Contents">
<span class="sig-name descname"><span class="pre">Contents</span></span><a class="headerlink" href="#vemmech.utils.Contents" title="Permalink to this definition"></a></dt>
<dd><p>UTILS</p>
<dl class="simple">
<dt>Files</dt><dd><p>addFluidContribMechVEM - SYNOPSIS:
C2D                    - Compute the matrix of normalized strain energies (D) from the elasticity
calStressEigsVEM       - calculate eigen values of stress tensor and the basis
calculateQC            - SYNOPSIS:
calculateQF            - SYNOPSIS:
calculateStressVEM     - Undocumented Utility Function
complex3DGrid          - SYNOPSIS:
Enu2C                  - For each cell, construct the 3x3 (in 2D) or 6x6 (in 3D) matrix representing
ENu2LMu_3D             - SYNOPSIS:
exploreSquareGrid      - Explore the different types of grids that can be set up using the function squareGrid
lincompTPFA            - Solve weakly compressible flow problem (fluxes/pressures) using TPFA method.
linearDisplacement     - SYNOPSIS:
squareGrid             - SYNOPSIS:
squareLayersTest       - SYNOPSIS:
squareTest             - Different test cases for linear elasticity on square domains
VEM2D_div              - Discrete divergence operator for the virtual element method in 2D
VEM3D_div              - Discrete divergence operator for the virtual element method in 3D
VEM_div                - Discrete divergence operator for the virtual element method</p>
</dd>
</dl>
</dd></dl>

<dl class="mat script">
<dt class="sig sig-object mat" id="vemmech.utils.exploreSquareGrid">
<span class="sig-name descname"><span class="pre">exploreSquareGrid</span></span><a class="headerlink" href="#vemmech.utils.exploreSquareGrid" title="Permalink to this definition"></a></dt>
<dd><p>Explore the different types of grids that can be set up using the function squareGrid</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.C2D">
<span class="sig-name descname"><span class="pre">C2D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">C</span></em>, <em class="sig-param"><span class="pre">G</span></em>, <em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.C2D" title="Permalink to this definition"></a></dt>
<dd><p>Compute the matrix of normalized strain energies (D) from the elasticity
tensor (C) associated with grid (G).</p>
<p>convert Stiffness tensor from Voigt notation to plain notations (no
factors are applied to the off-diagonal coefficients of the strain
tensor). The latter is used in our formulation of VEM. The resulting tensor
D is such that, for S in plain notation, we have: S’DS = energy.</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.ENu2LMu_3D">
<span class="sig-name descname"><span class="pre">ENu2LMu_3D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">E</span></em>, <em class="sig-param"><span class="pre">nu</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.ENu2LMu_3D" title="Permalink to this definition"></a></dt>
<dd><p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">[lambda, mu] = ENu2LMu_3D</span><span class="p">(</span>E, nu<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION: Compute the Lamé parameters lambda and mu in the 2D case
from the Young’s modulus E and Poisson’s ratio Nu. In the orthogonal
direction (with respect to the 2D plane), it is assumed zero
displacement. In particular, it implies that Nu = 0.5 corresponds as in
the 3D case to an incompressible material. An other assumption, which is
not used here, could be that there is no stress in the orthogonal
direction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>E</strong> – Young’s modulus</p></li>
<li><p><strong>nu</strong> – Poisson’s ratio</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>lambda</strong> – First Lamé coefficient</p></li>
<li><p><strong>mu</strong> – Second Lamé coefficient</p></li>
</ul>
</dd>
</dl>
<p>EXAMPLE:</p>
<p>SEE ALSO:</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.Enu2C">
<span class="sig-name descname"><span class="pre">Enu2C</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">E</span></em>, <em class="sig-param"><span class="pre">nu</span></em>, <em class="sig-param"><span class="pre">G</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.Enu2C" title="Permalink to this definition"></a></dt>
<dd><p>For each cell, construct the 3x3 (in 2D) or 6x6 (in 3D) matrix representing
the elasticity tensor.</p>
<p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>C<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">Enu2C</span><span class="p">(</span>E, nu, G<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION:</p>
<p>In 3D, the matrix of the elasticity tensor for a given cell is written:</p>
<div class="line-block">
<div class="line">1-nu  nu    nu    0          0          0         |</div>
<div class="line">nu    1-nu  nu    0          0          0         |</div>
<div class="line">nu    nu    1-nu  0          0          0         |            E</div>
<div class="line">0     0     0     (1-2nu)/2  0          0         |  x  ————–</div>
<div class="line">0     0     0     0          (1-2nu)/2  0         |     (1+nu) (1-2nu)</div>
<div class="line">0     0     0     0          0          (1-2nu)/2 |</div>
</div>
<dl class="simple">
<dt>In 3D, the inverse of the elasticity tensor is given by</dt><dd><dl class="simple">
<dt>[ [   1 / E,   -(nu / E), -(nu / E),      0,            0,            0       ]</dt><dd><p>[ -(nu / E),   1 / E,   -(nu / E),      0,            0,            0       ]
[ -(nu / E), -(nu / E),   1 / E,        0,            0,            0       ]
[     0,         0,         0,     2*(nu + 1) / E,      0,            0       ]
[     0,         0,         0,          0,       2*(nu + 1) / E,      0       ]
[     0,         0,         0,          0,            0,       2*(nu + 1) / E ] ]</p>
</dd>
</dl>
</dd>
<dt>In 2D, the inverse is given</dt><dd><dl class="simple">
<dt>[ [ 1 - nu,  -nu,   0 ]            1 + nu</dt><dd><p>[  -nu,   1 - nu, 0 ]     x  ————–
[   0,      0,    2 ] ]            E</p>
</dd>
</dl>
</dd>
</dl>
<p>The factors 2 in the expressions of the inverse above are due to Voigts
notations, see <a class="reference external" href="https://en.wikipedia.org/wiki/Voigt_notation">https://en.wikipedia.org/wiki/Voigt_notation</a></p>
<p>invCi = C^{-1}*(Identity tensor)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>E</strong> – Young’s modulus (one entry per cell)</p></li>
<li><p><strong>nu</strong> – Poisson ratio (one entry per cell)</p></li>
<li><p><strong>G</strong> – Grid</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>C</strong> – (k,n) matrix, where k=3^2 (2D) or k=6^2 (3D), and n is the number of
cells.  Each row thus represents the entries of the elasticity tensor
for a specific cell.</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.VEM2D_div">
<span class="sig-name descname"><span class="pre">VEM2D_div</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">G</span></em>, <em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.VEM2D_div" title="Permalink to this definition"></a></dt>
<dd><p>Discrete divergence operator for the virtual element method in 2D</p>
<p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>[div]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">VEM2D_div</span><span class="p">(</span>G<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION: Computes a discrete divergence operator in 2D. This discrete div operator is a mapping from node-valued
displacement vector to cell-valued 2D vector. Node-valued displacement vectors correspond to the degrees of freedom that
determine for each cell a displacement function over the cell via the virtual basis function. The discrete divergence
operator that is assembled here computes the divergence of the L^2 projection, cell-wise, of this displacement
function. For more detail, see paper [Andersen et al: <a class="reference external" href="http://arxiv.org/abs/1606.09508v1">http://arxiv.org/abs/1606.09508v1</a>].</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>G</strong> – Grid structure</p>
</dd>
<dt class="field-even">Keyword Arguments</dt>
<dd class="field-even"><p><strong>‘extraFaceDof’</strong> – This option has to be set to get a stable divergence
operator when extra degrees of freedom have been introduced
on the edges to avoid numerical locking.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>div</strong> – matrix corresponding to the discrete divergence operator.</p>
</dd>
</dl>
<p>EXAMPLE:</p>
<p>SEE ALSO:</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.VEM3D_div">
<span class="sig-name descname"><span class="pre">VEM3D_div</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">G</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.VEM3D_div" title="Permalink to this definition"></a></dt>
<dd><p>Discrete divergence operator for the virtual element method in 3D</p>
<p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>[div]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">VEM3D_div</span><span class="p">(</span>G<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION: Computes a discrete divergence operator in 3D. This discrete div
operator is a mapping from node-valued displacement vector to cell-valued 2D
vector. Node-valued displacement vectors correspond to the degrees of freedom
that determine for each cell a displacement function over the cell via the
virtual basis function. The discrete divergence operator that is assembled here
computes the L^2 projection, cell-wise, of this displacement function. For
more detail, see paper [Andersen et al: <a class="reference external" href="http://arxiv.org/abs/1606.09508v1">http://arxiv.org/abs/1606.09508v1</a>].</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>G</strong> – Grid structure</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>div</strong> – matrix corresponding to the discrete divergence operator.</p>
</dd>
</dl>
<p>EXAMPLE:</p>
<p>SEE ALSO:</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.VEM_div">
<span class="sig-name descname"><span class="pre">VEM_div</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">G</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.VEM_div" title="Permalink to this definition"></a></dt>
<dd><p>Discrete divergence operator for the virtual element method</p>
<p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>[div]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">VEM_div</span><span class="p">(</span>G<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION: Computes a discrete divergence operator. This discrete divergence operator is a
mapping from node-valued displacement vector to cell-valued
vector. Node-valued displacement vectors correspond to the degrees of freedom
that determine for each cell a displacement function over the cell via the
virtual basis function. The discrete divergence operator that is assembled here
computes the L^2 projection, cell-wise, of this displacement function. For
more detail, see paper [Andersen et al: <a class="reference external" href="http://arxiv.org/abs/1606.09508v1">http://arxiv.org/abs/1606.09508v1</a>].</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>G</strong> – Grid struture</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>div</strong> – matrix corresponding to the discrete divergence operator.</p>
</dd>
</dl>
<p>EXAMPLE:</p>
<p>SEE ALSO:</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.addFluidContribMechVEM">
<span class="sig-name descname"><span class="pre">addFluidContribMechVEM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">G</span></em>, <em class="sig-param"><span class="pre">bc</span></em>, <em class="sig-param"><span class="pre">rock</span></em>, <em class="sig-param"><span class="pre">isdirdofs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.addFluidContribMechVEM" title="Permalink to this definition"></a></dt>
<dd><p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>fbc<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">addFluidContribMechVEM</span><span class="p">(</span>G, bc, rock, isdirdofs<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION: Setup the force boundary condition for the mechanics
corresponding to the fluid boundary condition.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>G</strong> – Grid structure</p></li>
<li><p><strong>bc</strong> – Fluid boundary conditions.</p></li>
<li><p><strong>rock</strong> – Rock structure</p></li>
<li><p><strong>isdirdofs</strong> – Degrees of freedom where in fact Dirichlet boundary
conditions are imposed</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>fbc</strong> – Force load for the mechanical system.</p>
</dd>
</dl>
<p>EXAMPLE:</p>
<p>SEE ALSO:</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.calStressEigsVEM">
<span class="sig-name descname"><span class="pre">calStressEigsVEM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">G</span></em>, <em class="sig-param"><span class="pre">stress</span></em>, <em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.calStressEigsVEM" title="Permalink to this definition"></a></dt>
<dd><p>calculate eigen values of stress tensor and the basis</p>
<p>transform to traditional voits notation (for stress this has no factors)</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.calculateQC">
<span class="sig-name descname"><span class="pre">calculateQC</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">G</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.calculateQC" title="Permalink to this definition"></a></dt>
<dd><p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">[qc, qf, qcvol] = calculateQC</span><span class="p">(</span>G<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION:  Calculate elementary integrals that are used to assemble the
stiffness matrix for the 3D case. The precise definitions can be found in
[Gain et al: doi:10.1016/j.cma.2014.05.005].</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>G</strong> – Grid structure</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>qc</strong> – Elementary assembly integrals : One (3D) vector value in each
cell, see (74) in [Gain et al] (not divided by cell volume here in the code).</p></li>
<li><p><strong>qf</strong> – Elementary assembly integrals : One scalar value for each face
for each node, corresponds to (98) in [Gain et al].</p></li>
<li><p><strong>qcvol</strong> – Elementary assembly integrals : One scalar value for each node in each cells,
gives weights to compute the L^2
projections, see VEM_linElast.m</p></li>
</ul>
</dd>
</dl>
<p>EXAMPLE:</p>
<p>SEE ALSO:</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.calculateQF">
<span class="sig-name descname"><span class="pre">calculateQF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">G</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.calculateQF" title="Permalink to this definition"></a></dt>
<dd><p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">[qf, qf_vol] = calculateQF</span><span class="p">(</span>G<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION:  Calculate elementary integrals that are used to assemble the
stiffness matrix for the 2D case.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>G</strong> – Grid structure</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>qf</strong> – Elementary assembly integrals : One (2D) vector value in each cell,
which corresponds to the two components of the integral of the
basis function in each coordinate over the cell faces (see (74) in
[Gain et al: doi:10.1016/j.cma.2014.05.005], then faces there
correspond to edges here. We do not divide by 2*(cell volume) here).</p></li>
<li><p><strong>qf_vol</strong> – Elementary assembly integrals : one scalar value for each
node, wich corresponds to the weights that are used to
compute th L^2 projection, see VEM_linElast.m</p></li>
</ul>
</dd>
</dl>
<p>EXAMPLE:</p>
<p>SEE ALSO:</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.calculateStressVEM">
<span class="sig-name descname"><span class="pre">calculateStressVEM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">G</span></em>, <em class="sig-param"><span class="pre">uu</span></em>, <em class="sig-param"><span class="pre">op</span></em>, <em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.calculateStressVEM" title="Permalink to this definition"></a></dt>
<dd><p>Undocumented Utility Function</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.complex3DGrid">
<span class="sig-name descname"><span class="pre">complex3DGrid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">opt</span></em>, <em class="sig-param"><span class="pre">grid_case</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.complex3DGrid" title="Permalink to this definition"></a></dt>
<dd><p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">[G, G_org] = complex3DGrid</span><span class="p">(</span>opt, grid_case<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>opt</strong> – <p>Parameter structure with fields
L            - Physical dimension (‘box’ and ‘grdecl’ case)
cartDims     - Cartesian dimension (‘box’ and ‘grdecl’ case)
disturb      - disturbance parameter for the grid (‘box’ case)
triangulate  - If true, the horizontal faces are triangulated.
vertical     - Only relevant for Norne grid (straightens up</p>
<blockquote>
<div><p>the pillars, see paper [Andersen et al: <a class="reference external" href="http://arxiv.org/abs/1606.09508v1">http://arxiv.org/abs/1606.09508v1</a>])</p>
</div></blockquote>
<dl class="simple">
<dt>gtol         - Grid tolerance parameter (used when calling</dt><dd><p>processGRDECL, see documentation there)</p>
</dd>
</dl>
<p>ref          - Refinement parameter, only used for Norne grid</p>
</p></li>
<li><p><strong>grid_case</strong> – 3D Grid cases that are set up here.
‘box’    - grid set up using squareGrid function
‘grdecl’ - grid set up using Eclipse format
‘sbed’   - run dataset_bedmodel2() to get a full description
‘Norne’  - run dataset_norne() to get a full description</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>G</strong> – Grid that has been created</p></li>
<li><p><strong>G_org</strong> – Original grid without refinement (only ‘Norne’ case)</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="p">=</span><span class="n">complex3DGrid</span><span class="p">(</span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;vertical&#39;</span><span class="p">,</span><span class="nb">true</span><span class="p">,</span><span class="s">&#39;triangulate&#39;</span><span class="p">,</span><span class="nb">false</span><span class="p">,</span><span class="s">&#39;ref&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;gtol&#39;</span><span class="p">,</span><span class="mf">1e-3</span><span class="p">),</span><span class="s">&#39;norne&#39;</span><span class="p">);</span><span class="nb">clf</span><span class="p">,</span><span class="n">plotGrid</span><span class="p">(</span><span class="n">G</span><span class="p">),</span><span class="nb">view</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">G</span><span class="p">=</span><span class="n">complex3DGrid</span><span class="p">(</span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;triangulate&#39;</span><span class="p">,</span><span class="nb">false</span><span class="p">,</span><span class="s">&#39;gtol&#39;</span><span class="p">,</span><span class="mf">1e-3</span><span class="p">),</span><span class="s">&#39;sbed&#39;</span><span class="p">);</span><span class="nb">clf</span><span class="p">,</span><span class="n">plotGrid</span><span class="p">(</span><span class="n">G</span><span class="p">),</span><span class="nb">view</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">G</span><span class="p">=</span><span class="n">complex3DGrid</span><span class="p">(</span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;triangulate&#39;</span><span class="p">,</span><span class="nb">true</span><span class="p">,</span><span class="s">&#39;gtol&#39;</span><span class="p">,</span><span class="mf">1e-3</span><span class="p">),</span><span class="s">&#39;sbed&#39;</span><span class="p">);</span><span class="nb">clf</span><span class="p">,</span><span class="n">plotGrid</span><span class="p">(</span><span class="n">G</span><span class="p">),</span><span class="nb">view</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">G</span><span class="p">=</span><span class="n">complex3DGrid</span><span class="p">(</span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;triangulate&#39;</span><span class="p">,</span><span class="nb">false</span><span class="p">,</span><span class="s">&#39;gtol&#39;</span><span class="p">,</span><span class="mf">1e-3</span><span class="p">),</span><span class="s">&#39;sbed&#39;</span><span class="p">);</span><span class="nb">clf</span><span class="p">,</span><span class="n">plotGrid</span><span class="p">(</span><span class="n">flipGrid</span><span class="p">(</span><span class="n">G</span><span class="p">)),</span><span class="nb">view</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">G</span><span class="p">=</span><span class="n">complex3DGrid</span><span class="p">(</span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;cartDims&#39;</span><span class="p">,[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="s">&#39;L&#39;</span><span class="p">,[</span><span class="mi">3</span> <span class="mi">3</span> <span class="mi">3</span><span class="p">],</span><span class="s">&#39;disturb&#39;</span><span class="p">,</span><span class="mf">0.04</span><span class="p">,</span><span class="s">&#39;triangulate&#39;</span><span class="p">,</span><span class="nb">false</span><span class="p">),</span><span class="s">&#39;box&#39;</span><span class="p">);</span><span class="nb">clf</span><span class="p">,</span><span class="n">plotGrid</span><span class="p">(</span><span class="n">G</span><span class="p">),</span><span class="nb">view</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">G</span><span class="p">=</span><span class="n">complex3DGrid</span><span class="p">([],</span><span class="s">&#39;grdecl&#39;</span><span class="p">);</span> <span class="nb">clf</span><span class="p">,</span> <span class="n">plotGrid</span><span class="p">(</span><span class="n">G</span><span class="p">),</span> <span class="nb">view</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.lincompTPFA">
<span class="sig-name descname"><span class="pre">lincompTPFA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">dt</span></em>, <em class="sig-param"><span class="pre">state</span></em>, <em class="sig-param"><span class="pre">G</span></em>, <em class="sig-param"><span class="pre">T</span></em>, <em class="sig-param"><span class="pre">pv</span></em>, <em class="sig-param"><span class="pre">fluid</span></em>, <em class="sig-param"><span class="pre">rock</span></em>, <em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.lincompTPFA" title="Permalink to this definition"></a></dt>
<dd><p>Solve weakly compressible flow problem (fluxes/pressures) using TPFA method.</p>
<p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">state</span> <span class="p">=</span> <span class="n">lincompTPFA</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">fluid</span><span class="p">)</span>
<span class="n">state</span> <span class="p">=</span> <span class="n">lincompTPFA</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="s">&#39;pn1&#39;</span><span class="p">,</span> <span class="n">pv1</span><span class="p">,</span> <span class="p">...)</span>
</pre></div>
</div>
<p class="rubric">Description:</p>
<p>This function assembles and solves a (block) system of linear equations
defining interface fluxes and cell pressures at the next time step in a
sequential splitting scheme for the reservoir simulation problem
defined by Darcy’s law and a given set of external influences (wells,
sources, and boundary conditions).</p>
<p>This function uses a two-point flux approximation (TPFA) method with
minimal memory consumption within the constraints of operating on a
fully unstructured polyhedral grid structure.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> – Reservoir and well solution structure either properly
initialized from functions ‘initResSol’ and ‘initWellSol’
respectively, or the results from a previous call to function
‘lincompTPFA’ and, possibly, a transport solver such as
function ‘implicitTransport’.</p></li>
<li><p><strong>G</strong> – Grid and half-transmissibilities as computed by the function
‘computeTrans’.</p></li>
<li><p><strong>T</strong> – Grid and half-transmissibilities as computed by the function
‘computeTrans’.</p></li>
<li><p><strong>fluid</strong> – Fluid object as defined by function ‘initSimpleFluid’.</p></li>
</ul>
</dd>
<dt class="field-even">Keyword Arguments</dt>
<dd class="field-even"><ul>
<li><p><strong>wells</strong> – Well structure as defined by function ‘addWell’.  May be empty
(i.e., W = struct([])) which is interpreted as a model without
any wells.</p></li>
<li><p><strong>bc</strong> – Boundary condition structure as defined by function ‘addBC’.
This structure accounts for all external boundary conditions to
the reservoir flow.  May be empty (i.e., bc = struct([])) which
is interpreted as all external no-flow (homogeneous Neumann)
conditions.</p></li>
<li><p><strong>src</strong> – Explicit source contributions as defined by function
‘addSource’.  May be empty (i.e., src = struct([])) which is
interpreted as a reservoir model without explicit sources.</p></li>
<li><p><strong>LinSolve</strong> – Handle to linear system solver software to which the
fully assembled system of linear equations will be
passed.  Assumed to support the syntax</p>
<blockquote>
<div><p>x = LinSolve(A, b)</p>
</div></blockquote>
<p>in order to solve a system Ax=b of linear equations.
Default value: LinSolve = &#64;mldivide (backslash).</p>
</li>
<li><p><strong>MatrixOutput</strong> – Whether or not to return the final system matrix ‘A’ to
the caller of function ‘lincompTPFA’.
Logical.  Default value: MatrixOutput = FALSE.</p></li>
<li><p><strong>verbose</strong> – Enable output.  Default value dependent upon global verbose
settings of function ‘mrstVerbose’.</p></li>
<li><p><strong>condition_number</strong> – Display estimated condition number of linear system.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>state</strong> – Update reservoir and well solution structure with new values
for the fields:</p>
<blockquote>
<div><ul>
<li><dl class="simple">
<dt>pressure – Pressure values for all cells in the</dt><dd><p>discretised reservoir model, ‘G’.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>facePressure –</dt><dd><p>Pressure values for all interfaces in the
discretised reservoir model, ‘G’.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>flux     – Flux across global interfaces corresponding to</dt><dd><p>the rows of ‘G.faces.neighbors’.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>A        – System matrix.  Only returned if specifically</dt><dd><p>requested by setting option ‘MatrixOutput’.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>wellSol  – Well solution structure array, one element for</dt><dd><p>each well in the model, with new values for
the fields:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>flux     – Perforation fluxes through all</dt><dd><p>perforations for corresponding
well.  The fluxes are
interpreted as injection
fluxes, meaning positive
values correspond to injection
into reservoir while negative
values mean
production/extraction out of
reservoir.</p>
</dd>
</dl>
</li>
<li><p>pressure – Well bottom-hole pressure.</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If there are no external influences, i.e., if all of the structures
‘W’, ‘bc’, and ‘src’ are empty and there are no effects of gravity,
then the input values ‘xr’ and ‘xw’ are returned unchanged and a
warning is printed in the command window. This warning is printed with
message ID</p>
<blockquote>
<div><p>‘lincompTPFA:DrivingForce:Missing’</p>
</div></blockquote>
</div>
<p class="rubric">Example:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">G</span>   <span class="p">=</span> <span class="n">computeGeometry</span><span class="p">(</span><span class="n">cartGrid</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]));</span>

<span class="n">f</span>   <span class="p">=</span> <span class="n">initSingleFluid</span><span class="p">(</span><span class="s">&#39;mu&#39;</span> <span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">centi</span><span class="o">*</span><span class="n">poise</span><span class="p">,</span> <span class="p">...</span>
                      <span class="s">&#39;rho&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="o">*</span><span class="n">kilogram</span><span class="o">/</span><span class="n">meter</span>^<span class="mi">3</span><span class="p">);</span>
<span class="n">rock</span><span class="p">.</span><span class="n">perm</span> <span class="p">=</span> <span class="nb">rand</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">darcy</span><span class="p">()</span><span class="o">/</span><span class="mi">100</span><span class="p">;</span>

<span class="n">bc</span>  <span class="p">=</span> <span class="n">pside</span><span class="p">([],</span> <span class="n">G</span><span class="p">,</span> <span class="s">&#39;LEFT&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">barsa</span><span class="p">);</span>
<span class="n">src</span> <span class="p">=</span> <span class="n">addSource</span><span class="p">([],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">W</span>   <span class="p">=</span> <span class="n">verticalWell</span><span class="p">([],</span> <span class="n">G</span><span class="p">,</span> <span class="n">rock</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">G</span><span class="p">.</span><span class="n">cartDims</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">[]</span>   <span class="p">,</span> <span class="p">...</span>
                   <span class="s">&#39;Type&#39;</span><span class="p">,</span> <span class="s">&#39;rate&#39;</span><span class="p">,</span> <span class="s">&#39;Val&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">meter</span>^<span class="mi">3</span><span class="o">/</span><span class="n">day</span><span class="p">,</span> <span class="p">...</span>
                   <span class="s">&#39;InnerProduct&#39;</span><span class="p">,</span> <span class="s">&#39;ip_tpf&#39;</span><span class="p">);</span>
<span class="n">W</span>   <span class="p">=</span> <span class="n">verticalWell</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">rock</span><span class="p">,</span> <span class="n">G</span><span class="p">.</span><span class="n">cartDims</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">G</span><span class="p">.</span><span class="n">cartDims</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">[],</span> <span class="p">...</span>
                   <span class="s">&#39;Type&#39;</span><span class="p">,</span> <span class="s">&#39;bhp&#39;</span><span class="p">,</span> <span class="s">&#39;Val&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">barsa</span><span class="p">,</span> <span class="p">...</span>
                   <span class="s">&#39;InnerProduct&#39;</span><span class="p">,</span> <span class="s">&#39;ip_tpf&#39;</span><span class="p">);</span>

<span class="n">T</span>   <span class="p">=</span> <span class="n">computeTrans</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">rock</span><span class="p">);</span>

<span class="n">state</span>         <span class="p">=</span> <span class="n">initResSol</span> <span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="n">state</span><span class="p">.</span><span class="n">wellSol</span> <span class="p">=</span> <span class="n">initWellSol</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="n">state</span> <span class="p">=</span> <span class="n">lincompTPFA</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s">&#39;bc&#39;</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="s">&#39;src&#39;</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="p">...</span>
                   <span class="s">&#39;wells&#39;</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="s">&#39;MatrixOutput&#39;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

<span class="n">plotCellData</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">state</span><span class="p">.</span><span class="n">pressure</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="core.html#core.solvers.computeTrans" title="core.solvers.computeTrans"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">computeTrans</span></code></a>, <a class="reference internal" href="core.html#core.params.wells_and_bc.addBC" title="core.params.wells_and_bc.addBC"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">addBC</span></code></a>, <a class="reference internal" href="core.html#core.params.wells_and_bc.addSource" title="core.params.wells_and_bc.addSource"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">addSource</span></code></a>, <a class="reference internal" href="core.html#core.params.wells_and_bc.addWell" title="core.params.wells_and_bc.addWell"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">addWell</span></code></a>, <a class="reference internal" href="incomp.html#incomp.fluid.incompressible.initSingleFluid" title="incomp.fluid.incompressible.initSingleFluid"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">initSingleFluid</span></code></a>, <a class="reference internal" href="core.html#core.solvers.initResSol" title="core.solvers.initResSol"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">initResSol</span></code></a>,
<a class="reference internal" href="core.html#core.solvers.initWellSol" title="core.solvers.initWellSol"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">initWellSol</span></code></a>.</p>
</div>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.linearDisplacement">
<span class="sig-name descname"><span class="pre">linearDisplacement</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">dim</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.linearDisplacement" title="Permalink to this definition"></a></dt>
<dd><p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">[disp, names] = linearDisplacement</span><span class="p">(</span>dim<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dim</strong> – Dimension</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>disp</strong></p></li>
<li><p><strong>names</strong></p></li>
</ul>
</dd>
</dl>
<p>EXAMPLE:</p>
<p>SEE ALSO:</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.squareGrid">
<span class="sig-name descname"><span class="pre">squareGrid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">cartDims</span></em>, <em class="sig-param"><span class="pre">L</span></em>, <em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.squareGrid" title="Permalink to this definition"></a></dt>
<dd><p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="p">=</span> <span class="n">squareGrid</span><span class="p">(</span><span class="n">cartDims</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">varargin</span><span class="p">)</span>
</pre></div>
</div>
<p>DESCRIPTON:
Make square with different irregular grid types starting from cartesian.</p>
<p>run script exploreSquareGrid.m to see the different possibilities</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cartDims</strong> – Cartesian dimensions</p></li>
<li><p><strong>L</strong> – Physical lengths</p></li>
</ul>
</dd>
<dt class="field-even">Keyword Arguments</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>grid_type</strong> – Possible types are  ‘cartgrid’ ‘triangle’ ‘pebi’ ‘boxes[1-4]’
‘mixed[1-4]’. Run the scripts given in the comments below to
see how the grid look likes. Only the ‘cartgrid’ type is
implemented for 3D. The others apply uniquely for 2D.</p></li>
<li><p><strong>disturb</strong> – The grids can be twisted, essentially to break the Cartesian
structure. The parameter disturb determines the amount of
twisting that is introduced.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>G</strong> – Grid structure</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.squareLayersTest">
<span class="sig-name descname"><span class="pre">squareLayersTest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.squareLayersTest" title="Permalink to this definition"></a></dt>
<dd><p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">[G, bc, test_cases] = squareLayersTest</span><span class="p">(</span>varargin<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION:  make test cases for linear elasticity with several layers</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>varargin</strong> – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>G</strong></p></li>
<li><p><strong>bc</strong></p></li>
<li><p><strong>test_cases</strong></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.utils.squareTest">
<span class="sig-name descname"><span class="pre">squareTest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.utils.squareTest" title="Permalink to this definition"></a></dt>
<dd><p>Different test cases for linear elasticity on square domains</p>
<p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">[G, bc, test_cases] = squareTest</span><span class="p">(</span>varargin<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION: Set up different test cases to test the linear elasticity
code.</p>
<dl class="field-list simple">
<dt class="field-odd">Keyword Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>‘L’</strong> – Physical dimension</p></li>
<li><p><strong>‘cartDims’</strong> – Cartesian dimension</p></li>
<li><p><strong>‘grid_type’</strong> – grid type (see squareGrid function)</p></li>
<li><p><strong>‘disturb’</strong> – Disturbance coefficient</p></li>
<li><p><strong>‘E’</strong> – Young’s modulus</p></li>
<li><p><strong>‘nu’</strong> – Poisson’s ratio</p></li>
<li><p><strong>‘make_testcases’</strong> – If true, compute linear displacement test cases.</p></li>
<li><p><strong>‘test_name’</strong> – test case name. The alternatives are
‘original_2D_test’
‘hanging_rod_2D’
‘weighted_slop_rod_2D_dir’
‘weighted_slop_rod_2D’
‘weighted_slop_rod_2D_nobcleftright’
‘rod_2D_pressure’
‘rod_2D_pressure_nobcleftright’
‘rod_2D_point_pressure’
‘rod_2D_point_pressure_noleftrighbc’
‘all’</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>G</strong> – Grid structure</p></li>
<li><p><strong>bc</strong> – Boundary conditions</p></li>
<li><p><strong>test_cases</strong> – Cell structure with the test cases</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-vemmech.grid_utils"></span><dl class="mat script">
<dt class="sig sig-object mat" id="vemmech.grid_utils.Contents">
<span class="sig-name descname"><span class="pre">Contents</span></span><a class="headerlink" href="#vemmech.grid_utils.Contents" title="Permalink to this definition"></a></dt>
<dd><p>GRID_UTILS</p>
<dl class="simple">
<dt>Files</dt><dd><p>flipGrid            - Flip a grid (z-&gt;x, x-&gt;y, y-&gt;z)
padGrdecl           - Add padding to corner-point grid so it is embedded in a box
verticalGrdecl      - Transform GRDECL pillars into vertical pillars</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.grid_utils.flipGrid">
<span class="sig-name descname"><span class="pre">flipGrid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">G</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.grid_utils.flipGrid" title="Permalink to this definition"></a></dt>
<dd><p>Flip a grid (z-&gt;x, x-&gt;y, y-&gt;z)</p>
<p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>G_new<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">flipGrid</span><span class="p">(</span>G<span class="p">);</span>
</pre></div>
</div>
<p>DESCRIPTION: Flip the grid (z-&gt;x, x-&gt;y, y-&gt;z)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>G</strong> – Grid structure</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>G_new</strong> – Grid structure afte flipping</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.grid_utils.padGrdecl">
<span class="sig-name descname"><span class="pre">padGrdecl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">grdecl</span></em>, <em class="sig-param"><span class="pre">dirs</span></em>, <em class="sig-param"><span class="pre">box</span></em>, <em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.grid_utils.padGrdecl" title="Permalink to this definition"></a></dt>
<dd><p>Add padding to corner-point grid so it is embedded in a box</p>
<p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>grdecl_new<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">padGrdecl</span><span class="p">(</span>grdecl, dirs, box, varargin<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION: Adds padding on all the sides of a corner point grid in order to
make it a Cartesian box</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>grdecl</strong> – Grid in eclipse format</p></li>
<li><p><strong>dirs</strong> – Padding directions</p></li>
<li><p><strong>box</strong> – Size of elements in each padding layer</p></li>
</ul>
</dd>
<dt class="field-even">Keyword Arguments</dt>
<dd class="field-even"><p><strong>relative</strong></p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>grdecl_new</strong> – Grid in eclipse format, with padding.</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.grid_utils.verticalGrdecl">
<span class="sig-name descname"><span class="pre">verticalGrdecl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">grdecl</span></em>, <em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.grid_utils.verticalGrdecl" title="Permalink to this definition"></a></dt>
<dd><p>Transform GRDECL pillars into vertical pillars</p>
<p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>grdecl<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">verticalGrdecl</span><span class="p">(</span>grdecl, varargin<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION: Straightened up the pillars in a corner point grid, given in
Eclipse, and make them vertical</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>grdecl</strong> – Grid structure in Eclipse format</p>
</dd>
<dt class="field-even">Keyword Arguments</dt>
<dd class="field-even"><p><strong>method</strong> – ‘all’ : all pillars are made vertical</p>
<p>‘sides’ : Only the pillare on the sides are made vertical</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>grdecl</strong> – Grid structure with vertical pillars in Eclipse format.</p>
</dd>
</dl>
<p>EXAMPLE:
SEE ALSO:</p>
</dd></dl>

<span class="target" id="module-vemmech.models"></span><dl class="mat script">
<dt class="sig sig-object mat" id="vemmech.models.Contents">
<span class="sig-name descname"><span class="pre">Contents</span></span><a class="headerlink" href="#vemmech.models.Contents" title="Permalink to this definition"></a></dt>
<dd><p>MODELS</p>
<dl class="simple">
<dt>Files</dt><dd><p>LinearCompressibilityModel -</p>
</dd>
</dl>
</dd></dl>

<span class="target" id="module-vemmech.plotting"></span><dl class="mat script">
<dt class="sig sig-object mat" id="vemmech.plotting.Contents">
<span class="sig-name descname"><span class="pre">Contents</span></span><a class="headerlink" href="#vemmech.plotting.Contents" title="Permalink to this definition"></a></dt>
<dd><p>PLOTTING</p>
<dl class="simple">
<dt>Files</dt><dd><p>plotCellDataDeformed - SYNOPSIS:
plotFaceDataDeformed - SYNOPSIS:
plotFaces2D          - Undocumented Utility Function
plotGridDeformed     - SYNOPSIS:
plotNodeDataDeformed - SYNOPSIS:</p>
</dd>
</dl>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.plotting.plotCellDataDeformed">
<span class="sig-name descname"><span class="pre">plotCellDataDeformed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">G</span></em>, <em class="sig-param"><span class="pre">data</span></em>, <em class="sig-param"><span class="pre">u</span></em>, <em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.plotting.plotCellDataDeformed" title="Permalink to this definition"></a></dt>
<dd><p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>h<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">plotCellDataDeformed</span><span class="p">(</span>G, data, u, varargin<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION: Plot cell data on a grid which is deformed using a given
displacement field.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>G</strong> – Grid structure</p></li>
<li><p><strong>data</strong> – Data to be plotted</p></li>
<li><p><strong>u</strong> – Displacement field</p></li>
<li><p><strong>varargin</strong> – Optional parameters that are passed further to the function plotCellData</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>h</strong> – handle to plot</p>
</dd>
</dl>
<p>EXAMPLE:</p>
<p>SEE ALSO: <a class="reference internal" href="core.html#core.plotting.plotCellData" title="core.plotting.plotCellData"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">plotCellData</span></code></a></p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.plotting.plotFaceDataDeformed">
<span class="sig-name descname"><span class="pre">plotFaceDataDeformed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">G</span></em>, <em class="sig-param"><span class="pre">data</span></em>, <em class="sig-param"><span class="pre">u</span></em>, <em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.plotting.plotFaceDataDeformed" title="Permalink to this definition"></a></dt>
<dd><p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>h<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">plotFaceDataDeformed</span><span class="p">(</span>G, data, u, varargin<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION: Plot face data on a grid which is deformed using a given
displacement field.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>G</strong> – Grid structure</p></li>
<li><p><strong>data</strong> – Data to be plotted</p></li>
<li><p><strong>u</strong> – Displacement field</p></li>
<li><p><strong>varargin</strong> – Optional parameters that are passed further to the function plotFaceData</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>h</strong> – handle to plot</p>
</dd>
</dl>
<p>EXAMPLE:</p>
<p>SEE ALSO: <a class="reference internal" href="core.html#core.plotting.plotFaceData" title="core.plotting.plotFaceData"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">plotFaceData</span></code></a></p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.plotting.plotFaces2D">
<span class="sig-name descname"><span class="pre">plotFaces2D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">G</span></em>, <em class="sig-param"><span class="pre">faces</span></em>, <em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.plotting.plotFaces2D" title="Permalink to this definition"></a></dt>
<dd><p>Undocumented Utility Function</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.plotting.plotGridDeformed">
<span class="sig-name descname"><span class="pre">plotGridDeformed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">G</span></em>, <em class="sig-param"><span class="pre">u</span></em>, <em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.plotting.plotGridDeformed" title="Permalink to this definition"></a></dt>
<dd><p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>h<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">plotGridDeformed</span><span class="p">(</span>G, u, varargin<span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>DESCRIPTION: plot a deformed grid using a given displacement field</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>G</strong> – Grid structure</p></li>
<li><p><strong>u</strong> – Displacement field</p></li>
<li><p><strong>varargin</strong> – Optional parameters that are passed further to the function plotCellData</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>h</strong> – handle to plot</p>
</dd>
</dl>
<p>EXAMPLE:</p>
<p>SEE ALSO:</p>
</dd></dl>

<dl class="mat function">
<dt class="sig sig-object mat" id="vemmech.plotting.plotNodeDataDeformed">
<span class="sig-name descname"><span class="pre">plotNodeDataDeformed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">G</span></em>, <em class="sig-param"><span class="pre">node_data</span></em>, <em class="sig-param"><span class="pre">uu</span></em>, <em class="sig-param"><span class="pre">varargin</span></em><span class="sig-paren">)</span><a class="headerlink" href="#vemmech.plotting.plotNodeDataDeformed" title="Permalink to this definition"></a></dt>
<dd><p class="rubric">Synopsis:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">plotNodeDataDeformed</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node_data</span><span class="p">,</span> <span class="n">uu</span><span class="p">,</span> <span class="n">varargin</span><span class="p">)</span>
</pre></div>
</div>
<p>DESCRIPTION: Plot node data on a grid which is deformed using a given
displacement field.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>G</strong> – Grid data structure.</p></li>
<li><p><strong>node_data</strong> – node data to be plotted</p></li>
<li><p><strong>'pn'/pv</strong> – List of other property name/value pairs.  OPTIONAL.
This list will be passed directly on to function PATCH
meaning all properties supported by PATCH are valid.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>h</strong> – Handle to resulting PATCH object.  The patch object is added to the
current AXES object.</p>
</dd>
</dl>
<p>EXAMPLE:</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="core.html#core.plotting.plotCellData" title="core.plotting.plotCellData"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">plotCellData</span></code></a>, <a class="reference internal" href="core.html#core.plotting.plotGrid" title="core.plotting.plotGrid"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">plotGrid</span></code></a>, <code class="xref mat mat-func docutils literal notranslate"><span class="pre">newplot</span></code>, <code class="xref mat mat-func docutils literal notranslate"><span class="pre">patch</span></code>, <code class="xref mat mat-func docutils literal notranslate"><span class="pre">shading</span></code>.</p>
</div>
</dd></dl>

<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline"></a></h2>
<div class="section" id="compaction-test-case-in-2d">
<h3>Compaction test case in 2D<a class="headerlink" href="#compaction-test-case-in-2d" title="Permalink to this headline"></a></h3>
<p><em>Generated from compactionTest2D.m</em></p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">mrstModule</span> <span class="n">add</span> <span class="n">vemmech</span>
</pre></div>
</div>
<div class="section" id="define-the-fluid-and-rock-parameters-and-set-up-the-grid">
<h4>Define the fluid and rock parameters and set up the grid.<a class="headerlink" href="#define-the-fluid-and-rock-parameters-and-set-up-the-grid" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">opt</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;grid_type&#39;</span><span class="p">,</span> <span class="s">&#39;cartgrid&#39;</span><span class="p">,</span> <span class="c">...</span>
<span class="c">% see squareGrid</span>
            <span class="s">&#39;disturb&#39;</span>   <span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="c">...</span>
     <span class="c">% parameter for disturbing grid</span>
            <span class="s">&#39;E&#39;</span>         <span class="p">,</span> <span class="mf">0.3</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="c">...</span>
 <span class="c">% young&#39;s modulus</span>
            <span class="s">&#39;nu&#39;</span>        <span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="c">...</span>
            <span class="s">&#39;islinear&#39;</span>  <span class="p">,</span> <span class="n">false</span><span class="p">);</span>       <span class="c">% poisson&#39;s ratio</span>

<span class="n">opt</span><span class="p">.</span><span class="n">cartDims</span>       <span class="p">=</span> <span class="p">[</span><span class="mi">10</span> <span class="mi">10</span><span class="p">];</span>
<span class="n">opt</span><span class="p">.</span><span class="n">L</span>              <span class="p">=</span> <span class="p">[</span><span class="mi">15</span><span class="o">*</span><span class="mi">10</span><span class="o">/</span><span class="mi">10</span> <span class="mi">15</span><span class="p">];</span>
<span class="n">opt</span><span class="p">.</span><span class="n">hanging</span>        <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">opt</span><span class="p">.</span><span class="n">free_top</span>       <span class="p">=</span> <span class="n">true</span><span class="p">;</span> <span class="c">% If true, the nodes at the top can move freely (no</span>
                           <span class="c">% boundary condition given there)</span>
<span class="n">opt</span><span class="p">.</span><span class="n">triangulate</span>    <span class="p">=</span> <span class="n">true</span><span class="p">;</span> <span class="c">% If true, the horizontal faces are triangulated.</span>
<span class="n">opt</span><span class="p">.</span><span class="n">gravity_load</span>   <span class="p">=</span> <span class="n">true</span><span class="p">;</span> <span class="c">% Use gravity load</span>
<span class="n">opt</span><span class="p">.</span><span class="n">top_load</span>       <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">opt</span><span class="p">.</span><span class="n">gtol</span>           <span class="p">=</span> <span class="mf">0.1e-1</span><span class="p">;</span> <span class="c">% Grid tolerance parameter (used when calling</span>
                             <span class="c">% processGRDECL, see documentation there)</span>
<span class="n">opt</span><span class="p">.</span><span class="n">twist</span>          <span class="p">=</span> <span class="n">true</span><span class="p">;</span>
<span class="n">opt</span><span class="p">.</span><span class="n">disturb</span>        <span class="p">=</span> <span class="mf">0.05</span><span class="p">;</span>
<span class="c">% Different methods are implemented to compute the loading term, see</span>
<span class="c">% paper [Andersen et al: http://arxiv.org/abs/1606.09508v1].</span>
<span class="n">opt</span><span class="p">.</span><span class="n">force_method</span>   <span class="p">=</span> <span class="s">&#39;cell_force&#39;</span><span class="p">;</span> <span class="c">% &#39;dual_grad_type&#39;</span>

<span class="n">G</span> <span class="p">=</span> <span class="n">squareGrid</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">cartDims</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">L</span><span class="p">,</span> <span class="s">&#39;grid_type&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">grid_type</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">triangulate</span><span class="p">)</span>
    <span class="n">face</span> <span class="p">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">faces</span><span class="p">(</span><span class="n">any</span><span class="p">(</span><span class="nb">bsxfun</span><span class="p">(@</span><span class="n">eq</span><span class="p">,</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">faces</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">));</span>
    <span class="n">G</span> <span class="p">=</span> <span class="n">triangulateFaces</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">face</span><span class="p">);</span>
    <span class="n">G</span> <span class="p">=</span> <span class="n">sortEdges</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="k">end</span>

<span class="k">if</span> <span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">twist</span><span class="p">)</span>
    <span class="n">G</span> <span class="p">=</span> <span class="n">twister</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">disturb</span><span class="p">);</span>
<span class="k">end</span>

<span class="n">G</span> <span class="p">=</span> <span class="n">createAugmentedGrid</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="n">G</span> <span class="p">=</span> <span class="n">computeGeometry</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>

<span class="n">Ev</span>  <span class="p">=</span> <span class="nb">repmat</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">nuv</span> <span class="p">=</span> <span class="nb">repmat</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">nu</span><span class="p">,</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">C</span>   <span class="p">=</span> <span class="n">Enu2C</span><span class="p">(</span><span class="n">Ev</span><span class="p">,</span> <span class="n">nuv</span><span class="p">,</span> <span class="n">G</span><span class="p">);</span>

<span class="n">figure</span><span class="p">()</span>
<span class="n">clf</span><span class="p">,</span>
<span class="n">plotGrid</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s">&#39;Marker&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Grid&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/compactionTest2D_01.png" src="mrst/vemmech/examples/html/compactionTest2D_01.png" />
</div>
</div>
<div class="section" id="setup-the-loads-and-the-boundary-conditions">
<h4>Setup the loads and the boundary conditions<a class="headerlink" href="#setup-the-loads-and-the-boundary-conditions" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% We use the utility function makeCompactionTest</span>
<span class="p">[</span><span class="n">el_bc</span><span class="p">,</span> <span class="n">load</span><span class="p">]</span> <span class="p">=</span> <span class="n">makeCompactionTest</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">opt</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="assemble-and-solve-the-system">
<h4>Assemble and solve the system<a class="headerlink" href="#assemble-and-solve-the-system" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">bbsize</span> <span class="p">=</span> <span class="mi">30000</span><span class="o">-</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">20000</span><span class="p">;</span> <span class="c">% block size for the assembly</span>
<span class="n">uu</span> <span class="p">=</span> <span class="n">VEM_linElast</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">el_bc</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="c">...</span>
                  <span class="s">&#39;blocksize&#39;</span>   <span class="p">,</span> <span class="n">bbsize</span><span class="p">,</span> <span class="c">...</span>
                  <span class="s">&#39;force_method&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">force_method</span><span class="p">);</span>

<span class="n">figure</span><span class="p">(),</span>
<span class="n">clf</span>
<span class="n">plotNodeDataDeformed</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">uu</span><span class="p">(:,</span> <span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="p">),</span> <span class="n">uu</span><span class="p">);</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Displacement in the vertical direction&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/compactionTest2D_02.png" src="mrst/vemmech/examples/html/compactionTest2D_02.png" />
</div>
</div>
<div class="section" id="computation-of-the-analytical-solution">
<h4>Computation of the analytical solution<a class="headerlink" href="#computation-of-the-analytical-solution" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">el_bc</span><span class="p">.</span><span class="n">force_bc</span><span class="p">))</span>
    <span class="n">ff</span> <span class="p">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">el_bc</span><span class="p">.</span><span class="n">force_bc</span><span class="p">.</span><span class="n">force</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="p">));</span>
<span class="k">else</span>
    <span class="n">ff</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">end</span>
<span class="n">start</span> <span class="p">=</span> <span class="n">max</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">centroids</span><span class="p">(:,</span> <span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="p">));</span>
<span class="n">top</span>   <span class="p">=</span> <span class="n">min</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">centroids</span><span class="p">(:,</span> <span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="p">));</span>

<span class="n">fac</span> <span class="p">=</span> <span class="mi">100</span><span class="o">*</span><span class="mi">300</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

<span class="n">ana</span> <span class="p">=</span> <span class="p">@(</span><span class="n">z</span><span class="p">)</span> <span class="n">ff</span><span class="o">*</span><span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">./</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">-</span><span class="n">double</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">gravity_load</span><span class="p">)</span><span class="o">*</span><span class="n">fac</span><span class="o">*</span><span class="p">((</span><span class="n">top</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="n">top</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">divana</span> <span class="p">=</span> <span class="p">@(</span><span class="n">z</span><span class="p">)</span> <span class="p">(</span><span class="n">ff</span><span class="o">./</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">-</span><span class="n">double</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">gravity_load</span><span class="p">)</span><span class="o">*</span><span class="n">fac</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="n">top</span><span class="p">))</span><span class="o">/</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="comparison-plots">
<h4>Comparison plots<a class="headerlink" href="#comparison-plots" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="p">=</span> <span class="n">G</span><span class="p">.</span><span class="n">nodes</span><span class="p">.</span><span class="n">coords</span><span class="p">(:,</span> <span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="p">);</span>
<span class="n">z</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ana</span><span class="p">(</span><span class="n">z</span><span class="p">))</span><span class="o">&lt;</span><span class="n">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ana</span><span class="p">(</span><span class="n">z</span><span class="p">)))</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">)</span> <span class="p">=</span> <span class="nb">nan</span><span class="p">;</span>
<span class="n">zl</span> <span class="p">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">z</span><span class="p">);</span>

<span class="n">figure</span><span class="p">(),</span>
<span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">uu</span><span class="p">(:,</span> <span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="p">),</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">ana</span><span class="p">(</span><span class="n">zl</span><span class="p">))</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Displacement in the vertical direction&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">({</span><span class="s">&#39;computed solution&#39;</span><span class="p">,</span> <span class="s">&#39;analytical solution&#39;</span><span class="p">})</span>

<span class="n">figure</span><span class="p">()</span>
<span class="n">zc</span> <span class="p">=</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">centroids</span><span class="p">(:,</span> <span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="p">);</span>
<span class="n">div</span> <span class="p">=</span> <span class="n">VEM_div</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="n">plot</span><span class="p">(</span><span class="n">zc</span><span class="p">,</span> <span class="n">div</span><span class="o">*</span><span class="nb">reshape</span><span class="p">(</span><span class="n">uu</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">)</span><span class="o">./</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">volumes</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">zc</span><span class="p">,</span> <span class="n">divana</span><span class="p">(</span><span class="n">zc</span><span class="p">));</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Divergence&#39;</span><span class="p">);</span>
<span class="n">legend</span><span class="p">({</span><span class="s">&#39;computed solution&#39;</span><span class="p">,</span> <span class="s">&#39;analytical solution&#39;</span><span class="p">})</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/compactionTest2D_03.png" src="mrst/vemmech/examples/html/compactionTest2D_03.png" />
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/compactionTest2D_04.png" src="mrst/vemmech/examples/html/compactionTest2D_04.png" />
</div>
</div>
</div>
<div class="section" id="compaction-test-case-3d">
<h3>Compaction test case 3D<a class="headerlink" href="#compaction-test-case-3d" title="Permalink to this headline"></a></h3>
<p><em>Generated from compactionTest3D.m</em></p>
<div class="section" id="load-required-modules">
<h4>Load required modules<a class="headerlink" href="#load-required-modules" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">mrstModule</span> <span class="n">add</span> <span class="n">vemmech</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h4>Define the fluid and rock parameters and set up the grid.<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">opt</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;grid_type&#39;</span> <span class="p">,</span> <span class="s">&#39;triangle&#39;</span><span class="p">,</span> <span class="c">...</span>
             <span class="s">&#39;disturb&#39;</span>   <span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="c">...</span>
    <span class="c">% parameter for  grid distortion</span>
             <span class="s">&#39;E&#39;</span>         <span class="p">,</span> <span class="mf">0.3</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="c">...</span>
<span class="c">% Young&#39;s modulus</span>
             <span class="s">&#39;nu&#39;</span>        <span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="c">...</span>
    <span class="c">% Poison&#39;s ratio</span>
             <span class="s">&#39;islinear&#39;</span>  <span class="p">,</span> <span class="n">false</span><span class="p">);</span>
<span class="n">opt</span><span class="p">.</span><span class="n">L</span>            <span class="p">=</span> <span class="p">[</span><span class="mi">15</span> <span class="mi">15</span> <span class="mi">3</span><span class="p">];</span>
<span class="n">opt</span><span class="p">.</span><span class="n">islinear</span>     <span class="p">=</span> <span class="n">false</span><span class="p">;</span> <span class="c">% if true, the boundary condition is a given linear</span>
                          <span class="c">% displacement, see function makeCompactionTest.</span>
<span class="c">% Different methods are implemented to compute the loading term, see</span>
<span class="c">% paper [Andersen et al: http://arxiv.org/abs/1606.09508v1].</span>
<span class="n">opt</span><span class="p">.</span><span class="n">force_method</span> <span class="p">=</span> <span class="s">&#39;dual_grad_type&#39;</span><span class="p">;</span>
<span class="n">opt</span><span class="p">.</span><span class="n">hanging</span>      <span class="p">=</span> <span class="n">false</span><span class="p">;</span> <span class="c">% If true, zero displacement on the vertical sides.</span>
<span class="n">opt</span><span class="p">.</span><span class="n">free_top</span>     <span class="p">=</span> <span class="n">true</span><span class="p">;</span>  <span class="c">% If true, the nodes at the top can move freely (no</span>
                          <span class="c">% boundary condition given there)</span>
<span class="n">opt</span><span class="p">.</span><span class="n">triangulate</span>  <span class="p">=</span> <span class="n">false</span><span class="p">;</span>  <span class="c">% If true, the horizontal faces are triangulated.</span>
<span class="n">opt</span><span class="p">.</span><span class="n">vertical</span>     <span class="p">=</span> <span class="n">false</span><span class="p">;</span> <span class="c">% Only relevant for norne test case (straightens up</span>
                          <span class="c">% the pillars, see paper [Andersen et al: http://arxiv.org/abs/1606.09508v1])</span>
<span class="n">opt</span><span class="p">.</span><span class="n">gravity_load</span> <span class="p">=</span> <span class="n">true</span><span class="p">;</span>  <span class="c">% Use gravity load</span>
<span class="n">opt</span><span class="p">.</span><span class="n">top_load</span>     <span class="p">=</span> <span class="n">true</span><span class="p">;</span>  <span class="c">% Use force applied at the top</span>
<span class="n">opt</span><span class="p">.</span><span class="n">gtol</span>         <span class="p">=</span> <span class="mf">0.1e-1</span><span class="p">;</span> <span class="c">% Grid tolerance parameter (used when calling</span>
                           <span class="c">% processGRDECL, see documentation there)</span>
<span class="n">opt</span><span class="p">.</span><span class="n">ref</span>          <span class="p">=</span> <span class="mi">10</span><span class="p">;</span>     <span class="c">% Refinement parameter, only used for Norne</span>
<span class="n">opt</span><span class="p">.</span><span class="n">flipgrid</span>     <span class="p">=</span> <span class="n">false</span><span class="p">;</span>  <span class="c">% Rotate the grid (z-&gt;x, x-&gt;y, y-&gt;z) (see paper [Andersen et al: http://arxiv.org/abs/1606.09508v1])</span>
<span class="k">if</span> <span class="nb">isempty</span><span class="p">(</span><span class="n">mfilename</span><span class="p">)</span>
    <span class="c">% Running example interactively</span>
    <span class="n">grid_case_number</span> <span class="p">=</span> <span class="n">input</span><span class="p">([</span><span class="s">&#39;Choose a grid (type corresponding number): box [1], &#39;</span> <span class="c">...</span>
                              <span class="s">&#39;sbed [2], Norne [3]\n&#39;</span><span class="p">]);</span>
<span class="k">else</span>
    <span class="c">% Running example as a function</span>
    <span class="n">grid_case_number</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">end</span>
<span class="k">switch</span> <span class="n">grid_case_number</span>
  <span class="k">case</span> <span class="mi">1</span>
    <span class="n">grid_case</span> <span class="p">=</span> <span class="s">&#39;box&#39;</span><span class="p">;</span>
    <span class="n">opt</span><span class="p">.</span><span class="n">cartDims</span>     <span class="p">=</span> <span class="p">[[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="mi">10</span><span class="p">];</span> <span class="c">% set the Cartesian dimension for the box case</span>
  <span class="k">case</span> <span class="mi">2</span>
    <span class="n">grid_case</span> <span class="p">=</span> <span class="s">&#39;sbed&#39;</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">3</span>
    <span class="n">grid_case</span> <span class="p">=</span> <span class="s">&#39;norne&#39;</span><span class="p">;</span>
  <span class="k">otherwise</span>
    <span class="n">error</span><span class="p">(</span><span class="s">&#39;Choose grid case by typing number between 1 and 3.&#39;</span><span class="p">);</span>
<span class="k">end</span>

<span class="n">G</span> <span class="p">=</span> <span class="n">complex3DGrid</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">grid_case</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">flipgrid</span><span class="p">)</span>
    <span class="n">G</span> <span class="p">=</span> <span class="n">flipGrid</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="k">end</span>
<span class="n">G</span> <span class="p">=</span> <span class="n">createAugmentedGrid</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="n">G</span> <span class="p">=</span> <span class="n">computeGeometry</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>

<span class="n">Ev</span>     <span class="p">=</span> <span class="nb">repmat</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">nuv</span>    <span class="p">=</span> <span class="nb">repmat</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">nu</span><span class="p">,</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">C</span>      <span class="p">=</span> <span class="n">Enu2C</span><span class="p">(</span><span class="n">Ev</span><span class="p">,</span> <span class="n">nuv</span><span class="p">,</span> <span class="n">G</span><span class="p">);</span>

<span class="n">figure</span><span class="p">()</span>
<span class="n">clf</span><span class="p">;</span>
<span class="n">plotGrid</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="n">view</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/compactionTest3D_01.png" src="mrst/vemmech/examples/html/compactionTest3D_01.png" />
</div>
</div>
<div class="section" id="id2">
<h4>Setup the loads and the boundary conditions<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">grid_case</span><span class="p">,</span><span class="s">&#39;norne&#39;</span><span class="p">))</span>
    <span class="c">%only rolling in vertical direction this is need since norne has</span>
    <span class="c">%irregular sides and the code do not have genneral implementation of</span>
    <span class="c">%rolling condition at this point</span>
    <span class="p">[</span><span class="n">el_bc</span><span class="p">,</span> <span class="n">load</span><span class="p">]</span> <span class="p">=</span> <span class="n">makeCompactionTest</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="s">&#39;rolling_vertical&#39;</span><span class="p">,</span> <span class="n">true</span><span class="p">);</span>
<span class="k">else</span>
    <span class="p">[</span><span class="n">el_bc</span><span class="p">,</span> <span class="n">load</span><span class="p">]</span> <span class="p">=</span> <span class="n">makeCompactionTest</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">opt</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>Assemble and solve the system<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">bbsize</span> <span class="p">=</span> <span class="mi">30000</span><span class="o">-</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">20000</span><span class="p">;</span>
<span class="n">lsolve</span> <span class="p">=</span> <span class="p">@</span><span class="n">mldivide</span><span class="p">;</span>
<span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;Running ...</span>
<span class="s">&#39;</span><span class="p">);</span>
<span class="n">uu</span> <span class="p">=</span> <span class="n">VEM_linElast</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">el_bc</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="s">&#39;linsolve&#39;</span><span class="p">,</span> <span class="n">lsolve</span><span class="p">,</span> <span class="s">&#39;blocksize&#39;</span><span class="p">,</span> <span class="n">bbsize</span><span class="p">,</span> <span class="c">...</span>
                  <span class="s">&#39;force_method&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">force_method</span><span class="p">);</span>
<span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;done!\n&#39;</span><span class="p">);</span>

<span class="n">figure</span><span class="p">();</span>
<span class="n">clf</span><span class="p">;</span>
<span class="n">plotNodeDataDeformed</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">uu</span><span class="p">(:,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">uu</span><span class="p">);</span>
<span class="n">view</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Vertical displacement&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Running ... done!
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/compactionTest3D_02.png" src="mrst/vemmech/examples/html/compactionTest3D_02.png" />
</div>
</div>
<div class="section" id="compute-the-analytical-solution">
<h4>Compute  the analytical solution<a class="headerlink" href="#compute-the-analytical-solution" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">ff</span> <span class="p">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">el_bc</span><span class="p">.</span><span class="n">force_bc</span><span class="p">.</span><span class="n">force</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
<span class="n">start</span> <span class="p">=</span> <span class="n">max</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">centroids</span><span class="p">(:,</span> <span class="mi">3</span><span class="p">));</span>
<span class="n">top</span> <span class="p">=</span> <span class="n">min</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">centroids</span><span class="p">(:,</span> <span class="mi">3</span><span class="p">));</span>
<span class="p">[</span><span class="n">lambda</span><span class="p">,</span> <span class="n">mu</span><span class="p">]</span> <span class="p">=</span> <span class="n">ENu2LMu_3D</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">E</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">nu</span><span class="p">);</span>
<span class="n">gfac</span> <span class="p">=</span> <span class="mi">10</span><span class="o">*</span><span class="mi">3000</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="c">% gravity is 10, density is 3000, 2 is because of derivative</span>
<span class="n">ana</span> <span class="p">=</span> <span class="p">@(</span><span class="n">z</span><span class="p">)</span> <span class="n">ff</span><span class="o">*</span><span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">./</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">-</span><span class="n">double</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">gravity_load</span><span class="p">)</span><span class="o">*</span><span class="n">gfac</span><span class="o">*</span><span class="p">((</span><span class="n">top</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="n">top</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">divana</span> <span class="p">=</span> <span class="p">@(</span><span class="n">z</span><span class="p">)</span> <span class="p">(</span><span class="n">ff</span><span class="o">./</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">-</span><span class="n">double</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">gravity_load</span><span class="p">)</span><span class="o">*</span><span class="n">gfac</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="n">top</span><span class="p">))</span><span class="o">/</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4>Comparison plots<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="p">=</span> <span class="n">G</span><span class="p">.</span><span class="n">nodes</span><span class="p">.</span><span class="n">coords</span><span class="p">(:,</span> <span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="p">);</span>
<span class="n">z</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ana</span><span class="p">(</span><span class="n">z</span><span class="p">))</span><span class="o">&lt;</span><span class="n">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ana</span><span class="p">(</span><span class="n">z</span><span class="p">)))</span><span class="o">*</span><span class="mf">1e-2</span><span class="p">)</span> <span class="p">=</span> <span class="nb">nan</span><span class="p">;</span>
<span class="n">zl</span> <span class="p">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">z</span><span class="p">);</span>

<span class="n">figure</span><span class="p">(),</span>
<span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">uu</span><span class="p">(:,</span> <span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="p">),</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">zl</span><span class="p">,</span> <span class="n">ana</span><span class="p">(</span><span class="n">zl</span><span class="p">))</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Displacement in the vertical direction&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">({</span><span class="s">&#39;computed solution&#39;</span><span class="p">,</span> <span class="s">&#39;analytical solution&#39;</span><span class="p">})</span>

<span class="n">figure</span><span class="p">()</span>
<span class="n">zc</span> <span class="p">=</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">centroids</span><span class="p">(:,</span> <span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="p">);</span>
<span class="n">div</span> <span class="p">=</span> <span class="n">VEM_div</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="n">plot</span><span class="p">(</span><span class="n">zc</span><span class="p">,</span> <span class="n">div</span><span class="o">*</span><span class="nb">reshape</span><span class="p">(</span><span class="n">uu</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">)</span><span class="o">./</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">volumes</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">zc</span><span class="p">,</span> <span class="n">divana</span><span class="p">(</span><span class="n">zc</span><span class="p">));</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Divergence&#39;</span><span class="p">);</span>
<span class="n">legend</span><span class="p">({</span><span class="s">&#39;computed solution&#39;</span><span class="p">,</span> <span class="s">&#39;analytical solution&#39;</span><span class="p">})</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/compactionTest3D_03.png" src="mrst/vemmech/examples/html/compactionTest3D_03.png" />
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/compactionTest3D_04.png" src="mrst/vemmech/examples/html/compactionTest3D_04.png" />
</div>
</div>
</div>
<div class="section" id="linear-elasticity-on-complex-grid">
<h3>Linear Elasticity on Complex Grid<a class="headerlink" href="#linear-elasticity-on-complex-grid" title="Permalink to this headline"></a></h3>
<p><em>Generated from example_2D.m</em></p>
<p>We consider a case with a complex block-structured grid, in which each individual block is gridded using different grid types: curvilinear quadrilateral blocks, unstructured Voronoi grids, and triangular grids. The purpose of the example is to highlight the flexibility of the virtual element method.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">mrstModule</span> <span class="n">add</span> <span class="n">vemmech</span>
</pre></div>
</div>
<div class="section" id="set-up-the-rock-parameters-and-the-grid">
<h4>Set up the rock parameters and the grid<a class="headerlink" href="#set-up-the-rock-parameters-and-the-grid" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">E</span>  <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>    <span class="c">% Young&#39;s modulus</span>
<span class="n">nu</span> <span class="p">=</span> <span class="mf">0.3</span><span class="p">;</span>  <span class="c">% Poisson&#39;s ratio</span>

<span class="n">L</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">];</span> <span class="c">% Grid domain</span>
<span class="n">dims</span> <span class="p">=</span> <span class="p">[</span><span class="mi">16</span> <span class="mi">16</span><span class="p">];</span> <span class="c">% The grid size</span>

<span class="c">% Parameter used to twist the grid so that the Cartesian symmetries are</span>
<span class="c">% broken and we can test the method on more irregular grid.</span>
<span class="n">disturb</span> <span class="p">=</span> <span class="mf">0.03</span><span class="p">;</span>

<span class="n">test_name</span> <span class="p">=</span> <span class="s">&#39;original_2D_test&#39;</span><span class="p">;</span> <span class="c">% list of test names to be found in file</span>
                                <span class="c">% squareTest.</span>
<span class="n">grid_type</span> <span class="p">=</span> <span class="s">&#39;mixed4&#39;</span><span class="p">;</span> <span class="c">% Run the script exploreSquareGrid to see the grids</span>
                      <span class="c">% that have been set up to test this VEM code with</span>
                      <span class="c">% respect to different grid features.</span>

<span class="c">% We use the utility function squareTest to set up the problem, that is</span>
<span class="c">% defining the load and boundary conditions.</span>
<span class="p">[</span><span class="n">G</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">test_cases</span><span class="p">]</span> <span class="p">=</span> <span class="n">squareTest</span><span class="p">(</span><span class="s">&#39;E&#39;</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="s">&#39;nu&#39;</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="s">&#39;cartDims&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="c">...</span>
                                 <span class="s">&#39;L&#39;</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="s">&#39;grid_type&#39;</span><span class="p">,</span> <span class="n">grid_type</span><span class="p">,</span> <span class="s">&#39;disturb&#39;</span><span class="p">,</span> <span class="n">disturb</span><span class="p">,</span> <span class="c">...</span>
                                 <span class="s">&#39;make_testcases&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="s">&#39;test_name&#39;</span><span class="p">,</span> <span class="n">test_name</span><span class="p">);</span>
<span class="n">G</span> <span class="p">=</span> <span class="n">computeGeometry</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="n">clf</span><span class="p">,</span> <span class="n">plotGrid</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>

<span class="c">% We recover the problem parameters using the structure test_cases</span>
<span class="n">testcase</span> <span class="p">=</span> <span class="n">test_cases</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<span class="n">el_bc</span>    <span class="p">=</span> <span class="n">testcase</span><span class="p">.</span><span class="n">el_bc</span><span class="p">;</span> <span class="c">% The boundary conditions</span>
<span class="n">load</span>     <span class="p">=</span> <span class="n">testcase</span><span class="p">.</span><span class="n">load</span><span class="p">;</span>  <span class="c">% The load</span>
<span class="n">C</span>        <span class="p">=</span> <span class="n">testcase</span><span class="p">.</span><span class="n">C</span><span class="p">;</span>     <span class="c">% The material parameters in Voigts notations</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/example_2D_01.png" src="mrst/vemmech/examples/html/example_2D_01.png" />
</div>
</div>
<div class="section" id="we-assemble-and-solve-the-equations">
<h4>We assemble and solve the equations<a class="headerlink" href="#we-assemble-and-solve-the-equations" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">uVEM</span><span class="p">,</span> <span class="n">extra</span><span class="p">]</span> <span class="p">=</span> <span class="n">VEM_linElast</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">el_bc</span><span class="p">,</span> <span class="n">load</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="we-plot-the-results">
<h4>We plot the results<a class="headerlink" href="#we-plot-the-results" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">plotopts</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;EdgeAlpha&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">&#39;EdgeColor&#39;</span><span class="p">,</span> <span class="s">&#39;none&#39;</span><span class="p">};</span>
<span class="n">plotopts1</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;EdgeAlpha&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">};</span>
<span class="n">figure</span><span class="p">(</span><span class="s">&#39;Position&#39;</span><span class="p">,</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;DefaultFigurePosition&#39;</span><span class="p">)</span><span class="o">.*</span><span class="p">[</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">]);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">plotNodeData</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">uVEM</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">plotopts</span><span class="p">{:});</span> <span class="n">colorbar</span><span class="p">();</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;x displacement&#39;</span><span class="p">);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">plotNodeData</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">uVEM</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">plotopts</span><span class="p">{:});</span> <span class="n">colorbar</span><span class="p">();</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;y displacement&#39;</span><span class="p">);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="c">% We compute the divergence</span>
<span class="n">vdiv</span> <span class="p">=</span> <span class="n">VEM2D_div</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="n">mdiv</span> <span class="p">=</span> <span class="n">vdiv</span><span class="o">*</span><span class="nb">reshape</span><span class="p">(</span><span class="n">uVEM</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">)</span><span class="o">./</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">volumes</span><span class="p">;</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Divergence&#39;</span><span class="p">);</span>
<span class="n">plotCellDataDeformed</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">mdiv</span><span class="p">,</span> <span class="n">uVEM</span><span class="p">,</span> <span class="n">plotopts1</span><span class="p">{:});</span> <span class="n">colorbar</span><span class="p">();</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/example_2D_02.png" src="mrst/vemmech/examples/html/example_2D_02.png" />
</div>
</div>
</div>
<div class="section" id="a-short-example-solving-linear-elasticity-on-a-complex-grids">
<h3>A short example solving linear elasticity on a complex grids<a class="headerlink" href="#a-short-example-solving-linear-elasticity-on-a-complex-grids" title="Permalink to this headline"></a></h3>
<p><em>Generated from example_2D_complex_grid.m</em></p>
<div class="section" id="id5">
<h4>Load required modules<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">mrstModule</span> <span class="n">add</span> <span class="n">vemmech</span>
</pre></div>
</div>
</div>
<div class="section" id="define-parameters">
<h4>Define parameters<a class="headerlink" href="#define-parameters" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">opt</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;L&#39;</span>         <span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">],</span> <span class="c">...</span>
             <span class="s">&#39;cartDims&#39;</span>  <span class="p">,</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">4</span><span class="p">],</span> <span class="c">...</span>
             <span class="s">&#39;grid_type&#39;</span> <span class="p">,</span> <span class="s">&#39;square&#39;</span><span class="p">,</span> <span class="c">...</span>
             <span class="s">&#39;disturb&#39;</span>   <span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="c">...</span>
<span class="c">%parameter for disturbing grid</span>
             <span class="s">&#39;E&#39;</span>         <span class="p">,</span> <span class="mf">4e7</span><span class="p">,</span> <span class="c">...</span>
 <span class="c">%youngs modolo</span>
             <span class="s">&#39;nu&#39;</span>        <span class="p">,</span> <span class="mf">0.44</span><span class="p">);</span><span class="c">% poiso ratio</span>
</pre></div>
</div>
</div>
<div class="section" id="make-a-mixed-type-of-grid">
<h4>make a mixed type of grid<a class="headerlink" href="#make-a-mixed-type-of-grid" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="p">=</span> <span class="n">squareGrid</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">cartDims</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">L</span><span class="p">,</span> <span class="s">&#39;grid_type&#39;</span><span class="p">,</span> <span class="s">&#39;mixed4&#39;</span><span class="p">,</span> <span class="s">&#39;disturb&#39;</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">disturb</span><span class="p">);</span>
<span class="n">G</span> <span class="p">=</span> <span class="n">removeCells</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="p">[</span><span class="mi">140</span> <span class="p">:</span> <span class="mi">151</span><span class="p">,</span> <span class="mi">233</span> <span class="p">:</span> <span class="mi">235</span><span class="p">,</span> <span class="mi">249</span> <span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">117</span> <span class="p">:</span> <span class="mi">118</span><span class="p">]</span><span class="o">&#39;</span><span class="p">);</span>
<span class="n">G</span> <span class="p">=</span> <span class="n">createAugmentedGrid</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="n">G</span> <span class="p">=</span> <span class="n">computeGeometry</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="n">figure</span><span class="p">()</span>
<span class="n">plotGrid</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Original grid&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/example_2D_complex_grid_01.png" src="mrst/vemmech/examples/html/example_2D_complex_grid_01.png" />
</div>
</div>
<div class="section" id="find-sides-of-domain">
<h4>Find sides of domain<a class="headerlink" href="#find-sides-of-domain" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Lx</span><span class="p">,</span> <span class="n">Ly</span><span class="p">]</span> <span class="p">=</span> <span class="n">deal</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">L</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">opt</span><span class="p">.</span><span class="n">L</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="n">assert</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">griddim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">Lx</span><span class="p">];</span>
<span class="n">bc</span> <span class="p">=</span> <span class="n">cell</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span>
    <span class="n">faces</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">centroids</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nb">eps</span><span class="p">);</span>
    <span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">}</span> <span class="p">=</span> <span class="n">addBC</span><span class="p">([],</span> <span class="n">faces</span><span class="p">,</span> <span class="s">&#39;pressure&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">}</span> <span class="p">=</span> <span class="n">rmfield</span><span class="p">(</span><span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">},</span> <span class="s">&#39;type&#39;</span><span class="p">);</span>
    <span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">}</span> <span class="p">=</span> <span class="n">rmfield</span><span class="p">(</span><span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">},</span> <span class="s">&#39;sat&#39;</span><span class="p">);</span>
<span class="k">end</span>
<span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ly</span><span class="p">];</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span>
    <span class="n">faces</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">centroids</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nb">eps</span><span class="p">);</span>
    <span class="n">bc</span><span class="p">{</span><span class="nb">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">}</span> <span class="p">=</span> <span class="n">addBC</span><span class="p">([],</span> <span class="n">faces</span><span class="p">,</span> <span class="s">&#39;pressure&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">bc</span><span class="p">{</span><span class="nb">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">}</span> <span class="p">=</span> <span class="n">rmfield</span><span class="p">(</span><span class="n">bc</span><span class="p">{</span><span class="nb">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">},</span> <span class="s">&#39;type&#39;</span><span class="p">);</span>
    <span class="n">bc</span><span class="p">{</span><span class="nb">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">}</span> <span class="p">=</span> <span class="n">rmfield</span><span class="p">(</span><span class="n">bc</span><span class="p">{</span><span class="nb">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">},</span> <span class="s">&#39;sat&#39;</span><span class="p">);</span>
<span class="k">end</span>

<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">4</span>
    <span class="n">inodes</span> <span class="p">=</span> <span class="n">mcolon</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">nodePos</span><span class="p">(</span><span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">}.</span><span class="n">face</span><span class="p">),</span> <span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">nodePos</span><span class="p">(</span><span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">}.</span><span class="n">face</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">nodes</span> <span class="p">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">inodes</span><span class="p">));</span>
    <span class="c">% Set up the boudary conditions.</span>
    <span class="c">% Note that the fields &#39;faces&#39; and &#39;uu_face&#39; are not needed for VEM but</span>
    <span class="c">% will become necessary when running other methods (such as MPSA)</span>
    <span class="n">disp_bc</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;nodes&#39;</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="c">...</span>
        <span class="s">&#39;uu&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="c">...</span>
        <span class="s">&#39;faces&#39;</span><span class="p">,</span> <span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">}.</span><span class="n">face</span><span class="p">,</span> <span class="c">...</span>
        <span class="s">&#39;uu_face&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="c">...</span>
        <span class="s">&#39;mask&#39;</span><span class="p">,</span> <span class="n">true</span><span class="p">(</span><span class="nb">numel</span><span class="p">(</span><span class="n">nodes</span><span class="p">),</span> <span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="p">));</span>
    <span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">}.</span><span class="n">el_bc</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;disp_bc&#39;</span><span class="p">,</span> <span class="n">disp_bc</span><span class="p">,</span> <span class="s">&#39;force_bc&#39;</span><span class="p">,</span> <span class="p">[]);</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up-the-loading-term">
<h4>Set up the loading term<a class="headerlink" href="#set-up-the-loading-term" title="Permalink to this headline"></a></h4>
<p>Gravity is our loading term</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">density</span> <span class="p">=</span> <span class="mi">3000</span><span class="p">;</span> <span class="c">%kg/m^3</span>
<span class="n">grav</span> <span class="p">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c">%gravity</span>
<span class="n">load</span> <span class="p">=</span> <span class="p">@(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">grav</span><span class="o">*</span><span class="n">density</span><span class="p">)</span><span class="o">*</span><span class="nb">repmat</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up-the-displacement-boundary-condtions">
<h4>Set up the displacement boundary condtions<a class="headerlink" href="#set-up-the-displacement-boundary-condtions" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Set boundary displacement function to zero</span>
<span class="n">bcdisp</span> <span class="p">=</span> <span class="p">@(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">*</span><span class="mf">0.0</span><span class="p">;</span>

<span class="c">% Set up the boundary conditions for each side</span>
<span class="n">bc_el_sides</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span> <span class="p">=</span> <span class="n">bc</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span> <span class="c">% x side is fixed</span>
<span class="n">bc_el_sides</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span> <span class="p">=</span> <span class="n">bc</span><span class="p">{</span><span class="mi">2</span><span class="p">};</span> <span class="c">% y side is fixed</span>
<span class="n">bc_el_sides</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span> <span class="p">=</span> <span class="p">[];</span>    <span class="c">% bottom  is free</span>
<span class="n">bc_el_sides</span><span class="p">{</span><span class="mi">4</span><span class="p">}</span> <span class="p">=</span> <span class="p">[];</span>    <span class="c">% top is free</span>

<span class="c">% Collect the displacement boundary conditions</span>
<span class="n">nodes</span> <span class="p">=</span> <span class="p">[];</span>
<span class="n">faces</span> <span class="p">=</span> <span class="p">[];</span>
<span class="n">mask</span>  <span class="p">=</span> <span class="p">[];</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="nb">numel</span><span class="p">(</span><span class="n">bc</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">bc_el_sides</span><span class="p">{</span><span class="nb">i</span><span class="p">}))</span>
        <span class="n">nodes</span> <span class="p">=</span> <span class="p">[</span><span class="n">nodes</span><span class="p">;</span> <span class="n">bc_el_sides</span><span class="p">{</span><span class="nb">i</span><span class="p">}.</span><span class="n">el_bc</span><span class="p">.</span><span class="n">disp_bc</span><span class="p">.</span><span class="n">nodes</span><span class="p">];</span> <span class="c">%#ok</span>
        <span class="n">faces</span> <span class="p">=</span> <span class="p">[</span><span class="n">faces</span><span class="p">;</span> <span class="n">bc_el_sides</span><span class="p">{</span><span class="nb">i</span><span class="p">}.</span><span class="n">el_bc</span><span class="p">.</span><span class="n">disp_bc</span><span class="p">.</span><span class="n">faces</span><span class="p">];</span> <span class="c">%#ok</span>
        <span class="n">mask</span>  <span class="p">=</span> <span class="p">[</span><span class="n">mask</span><span class="p">;</span> <span class="n">bc_el_sides</span><span class="p">{</span><span class="nb">i</span><span class="p">}.</span><span class="n">el_bc</span><span class="p">.</span><span class="n">disp_bc</span><span class="p">.</span><span class="n">mask</span><span class="p">];</span>   <span class="c">%#ok</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">disp_node</span>  <span class="p">=</span> <span class="n">bcdisp</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">nodes</span><span class="p">.</span><span class="n">coords</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="p">:));</span>
<span class="n">disp_faces</span> <span class="p">=</span> <span class="n">bcdisp</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">centroids</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="p">:));</span>
<span class="n">disp_bc</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;nodes&#39;</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="s">&#39;uu&#39;</span><span class="p">,</span> <span class="n">disp_node</span><span class="p">,</span> <span class="s">&#39;faces&#39;</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="s">&#39;uu_face&#39;</span><span class="p">,</span> <span class="n">disp_faces</span><span class="p">,</span> <span class="s">&#39;mask&#39;</span><span class="p">,</span> <span class="n">mask</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up-the-force-boundary-conditions">
<h4>Set up the force boundary conditions<a class="headerlink" href="#set-up-the-force-boundary-conditions" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% A force is applied on the top surface. It is discontinuous in the sense</span>
<span class="c">% that it takes two different values on the left and on the right.</span>
<span class="n">force</span> <span class="p">=</span> <span class="mi">50</span><span class="o">*</span><span class="n">barsa</span><span class="p">;</span>
<span class="n">face_force</span> <span class="p">=</span> <span class="p">@(</span><span class="n">x</span><span class="p">)</span> <span class="n">force</span><span class="o">*</span><span class="nb">sign</span><span class="p">(</span><span class="n">x</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">opt</span><span class="p">.</span><span class="n">L</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span><span class="o">*</span><span class="n">barsa</span><span class="p">;</span>
<span class="n">faces</span> <span class="p">=</span> <span class="n">bc</span><span class="p">{</span><span class="mi">4</span><span class="p">}.</span><span class="n">face</span><span class="p">;</span>
<span class="c">% Set up the force boundary structure,</span>
<span class="c">% Note that the unit for the  force is  Pa/m^3.</span>
<span class="n">force_bc</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;faces&#39;</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="s">&#39;force&#39;</span><span class="p">,</span> <span class="nb">bsxfun</span><span class="p">(@</span><span class="n">times</span><span class="p">,</span> <span class="n">face_force</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">centroids</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="p">:)),</span> <span class="p">[</span><span class="mi">0</span> <span class="o">-</span><span class="mi">1</span><span class="p">]));</span>


<span class="c">% Final structure defining the boundary conditions</span>
<span class="n">el_bc</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;disp_bc&#39;</span><span class="p">,</span> <span class="n">disp_bc</span><span class="p">,</span> <span class="s">&#39;force_bc&#39;</span><span class="p">,</span> <span class="n">force_bc</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="define-the-rock-parameters">
<h4>Define the rock parameters<a class="headerlink" href="#define-the-rock-parameters" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">Ev</span> <span class="p">=</span> <span class="nb">repmat</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">nuv</span> <span class="p">=</span> <span class="nb">repmat</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">nu</span><span class="o">*</span><span class="mi">0</span> <span class="o">+</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">C</span> <span class="p">=</span> <span class="n">Enu2C</span><span class="p">(</span><span class="n">Ev</span><span class="p">,</span> <span class="n">nuv</span><span class="p">,</span> <span class="n">G</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4>Assemble and solve the system<a class="headerlink" href="#id6" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">lsolve</span> <span class="p">=</span> <span class="p">@</span><span class="n">mldivide</span><span class="p">;</span>
<span class="p">[</span><span class="n">uu</span><span class="p">,</span> <span class="n">extra</span><span class="p">]</span> <span class="p">=</span> <span class="n">VEM_linElast</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">el_bc</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="s">&#39;linsolve&#39;</span><span class="p">,</span> <span class="n">lsolve</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="plot-displacement-in-y-direction">
<h4>Plot displacement in y direction<a class="headerlink" href="#plot-displacement-in-y-direction" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">plotopts</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;EdgeAlpha&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">&#39;EdgeColor&#39;</span><span class="p">,</span> <span class="s">&#39;none&#39;</span><span class="p">};</span>
<span class="n">plotopts1</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;EdgeAlpha&#39;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">};</span>
<span class="n">figure</span><span class="p">()</span>
<span class="n">plotNodeData</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">uu</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">plotopts</span><span class="p">{</span> <span class="p">:</span> <span class="p">});</span>
<span class="n">colorbar</span><span class="p">();</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Displacement in the y direction&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/example_2D_complex_grid_02.png" src="mrst/vemmech/examples/html/example_2D_complex_grid_02.png" />
</div>
</div>
<div class="section" id="plot-the-displacement-in-x-direction">
<h4>Plot the displacement in x direction<a class="headerlink" href="#plot-the-displacement-in-x-direction" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">()</span>
<span class="n">plotNodeData</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">uu</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">plotopts</span><span class="p">{</span> <span class="p">:</span> <span class="p">});</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Displacement in the x direction&#39;</span><span class="p">);</span>
<span class="n">colorbar</span><span class="p">();</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/example_2D_complex_grid_03.png" src="mrst/vemmech/examples/html/example_2D_complex_grid_03.png" />
</div>
</div>
<div class="section" id="plot-the-deformed-grid">
<h4>plot the deformed grid<a class="headerlink" href="#plot-the-deformed-grid" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">()</span>
<span class="n">fac</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">plotGridDeformed</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">uu</span><span class="o">*</span><span class="n">fac</span><span class="p">);</span> <span class="n">axis</span> <span class="n">tight</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;The deformed grid&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/example_2D_complex_grid_04.png" src="mrst/vemmech/examples/html/example_2D_complex_grid_04.png" />
</div>
</div>
<div class="section" id="calculate-and-plot-the-divergence">
<h4>Calculate and plot the divergence<a class="headerlink" href="#calculate-and-plot-the-divergence" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">vdiv</span> <span class="p">=</span> <span class="n">VEM_div</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="n">mdiv</span> <span class="p">=</span> <span class="n">vdiv</span><span class="o">*</span><span class="nb">reshape</span><span class="p">(</span><span class="n">uu</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">)</span><span class="o">./</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">volumes</span><span class="p">;</span>
<span class="n">figure</span><span class="p">()</span>
<span class="n">plotCellDataDeformed</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">mdiv</span><span class="p">,</span> <span class="n">uu</span><span class="o">*</span><span class="n">fac</span><span class="p">,</span> <span class="n">plotopts1</span><span class="p">{</span> <span class="p">:</span> <span class="p">});</span> <span class="n">axis</span> <span class="n">tight</span>
<span class="n">colorbar</span><span class="p">()</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Divergence of the displacement field&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/example_2D_complex_grid_05.png" src="mrst/vemmech/examples/html/example_2D_complex_grid_05.png" />
</div>
</div>
<div class="section" id="calulate-the-stress-and-strain">
<h4>Calulate the stress and strain<a class="headerlink" href="#calulate-the-stress-and-strain" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">op</span> <span class="p">=</span> <span class="n">extra</span><span class="p">;</span>
<span class="n">stress</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">op</span><span class="p">.</span><span class="n">D</span><span class="o">*</span><span class="n">op</span><span class="p">.</span><span class="n">WC</span><span class="o">&#39;*</span><span class="n">op</span><span class="p">.</span><span class="n">assemb</span><span class="o">&#39;*</span><span class="nb">reshape</span><span class="p">(</span><span class="n">uu</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[])</span><span class="o">&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-using-three-layers-with-different-parameters-in-each-layer">
<h3>Example using three layers with different parameters in each layer<a class="headerlink" href="#example-using-three-layers-with-different-parameters-in-each-layer" title="Permalink to this headline"></a></h3>
<p><em>Generated from example_2D_layers.m</em></p>
<p>We set up a</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">mrstModule</span> <span class="n">add</span> <span class="n">vemmech</span>
</pre></div>
</div>
<div class="section" id="id7">
<h4>Set up the rock parameters and the grid<a class="headerlink" href="#id7" title="Permalink to this headline"></a></h4>
<p>Use the utility function squareLayersTest to set up the problem. You may look at the documentation of this function and try the other settings presented there by modifying this example.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">E</span>  <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">;</span> <span class="mi">10</span><span class="p">;</span> <span class="mi">1</span><span class="p">];</span>      <span class="c">% Define the Youngs moduli in the layers</span>
<span class="n">nu</span> <span class="p">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">;</span> <span class="mf">0.3</span><span class="p">;</span> <span class="mf">0.3</span><span class="p">];</span> <span class="c">% Define the Poisson&#39;s ratio in the layers</span>

<span class="n">zlayers</span> <span class="p">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">;</span> <span class="mf">0.3</span><span class="p">;</span> <span class="mf">0.3</span><span class="p">];</span> <span class="c">% Define the width of the layers.</span>
<span class="n">zlayers</span> <span class="p">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">sum</span><span class="p">(</span><span class="n">zlayers</span><span class="p">)</span><span class="o">*</span><span class="n">zlayers</span><span class="p">;</span>
<span class="n">L</span>    <span class="p">=</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">];</span>   <span class="c">% Define the domain size</span>

<span class="c">% Define the grid type, for example &#39;mixed4&#39;</span>
<span class="n">grid_type</span> <span class="p">=</span> <span class="s">&#39;mixed4&#39;</span><span class="p">;</span>
<span class="n">dims</span><span class="p">=</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">4</span><span class="p">];</span>

<span class="c">% Define test case type. It determines the boundary conditions and the forces</span>
<span class="n">test_name</span> <span class="p">=</span> <span class="s">&#39;hanging_rod_2D&#39;</span><span class="p">;</span>
<span class="c">% Parameter used to twist the grid so that the Cartesian symmetries are</span>
<span class="c">% broken and we can test the method on more irregular grid.</span>
<span class="n">disturb</span> <span class="p">=</span> <span class="mf">0.042</span><span class="p">;</span>

<span class="c">% The utility function squareLayersTest sets up the problem.</span>
<span class="p">[</span><span class="n">G</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">test_cases</span><span class="p">]</span> <span class="p">=</span> <span class="n">squareLayersTest</span><span class="p">(</span><span class="s">&#39;E&#39;</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="s">&#39;nu&#39;</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="s">&#39;zlayers&#39;</span><span class="p">,</span> <span class="c">...</span>
    <span class="n">zlayers</span><span class="p">,</span> <span class="s">&#39;cartDims&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="s">&#39;L&#39;</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="s">&#39;grid_type&#39;</span><span class="p">,</span> <span class="n">grid_type</span><span class="p">,</span> <span class="s">&#39;disturb&#39;</span><span class="p">,</span> <span class="c">...</span>
    <span class="n">disturb</span><span class="p">,</span> <span class="s">&#39;make_testcases&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="s">&#39;test_name&#39;</span><span class="p">,</span> <span class="n">test_name</span><span class="p">);</span>
<span class="n">G</span> <span class="p">=</span> <span class="n">computeGeometry</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="n">figure</span><span class="p">,</span>
<span class="n">plotGrid</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>

<span class="c">% We recover the problem parameters using the structure test_cases</span>
<span class="n">testcase</span> <span class="p">=</span> <span class="n">test_cases</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<span class="n">el_bc</span>    <span class="p">=</span> <span class="n">testcase</span><span class="p">.</span><span class="n">el_bc</span><span class="p">;</span> <span class="c">% The boundary conditions</span>
<span class="n">load</span>     <span class="p">=</span> <span class="n">testcase</span><span class="p">.</span><span class="n">load</span><span class="p">;</span>  <span class="c">% The load</span>
<span class="n">C</span>        <span class="p">=</span> <span class="n">testcase</span><span class="p">.</span><span class="n">C</span><span class="p">;</span>     <span class="c">% The material parameters in Voigts notations</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/example_2D_layers_01.png" src="mrst/vemmech/examples/html/example_2D_layers_01.png" />
</div>
</div>
<div class="section" id="id8">
<h4>We assemble and solve the equations<a class="headerlink" href="#id8" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">uVEM</span><span class="p">,</span> <span class="n">extra</span><span class="p">]</span> <span class="p">=</span> <span class="n">VEM_linElast</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">el_bc</span><span class="p">,</span> <span class="n">load</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h4>We plot the results<a class="headerlink" href="#id9" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">plotopts</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;EdgeAlpha&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">&#39;EdgeColor&#39;</span><span class="p">,</span> <span class="s">&#39;none&#39;</span><span class="p">};</span>
<span class="n">plotopts1</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;EdgeAlpha&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">};</span>
<span class="n">figure</span><span class="p">(</span><span class="s">&#39;Position&#39;</span><span class="p">,</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;DefaultFigurePosition&#39;</span><span class="p">)</span><span class="o">.*</span><span class="p">[</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">]);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">plotNodeData</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">uVEM</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">plotopts</span><span class="p">{:});</span> <span class="n">colorbar</span><span class="p">();</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;x displacement&#39;</span><span class="p">);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">plotNodeData</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">uVEM</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">plotopts</span><span class="p">{:});</span> <span class="n">colorbar</span><span class="p">();</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;y displacement&#39;</span><span class="p">);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="c">% We compute the divergence</span>
<span class="n">vdiv</span> <span class="p">=</span> <span class="n">VEM2D_div</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="n">mdiv</span> <span class="p">=</span> <span class="n">vdiv</span><span class="o">*</span><span class="nb">reshape</span><span class="p">(</span><span class="n">uVEM</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">)</span><span class="o">./</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">volumes</span><span class="p">;</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Divergence&#39;</span><span class="p">);</span>
<span class="n">plotCellDataDeformed</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">mdiv</span><span class="p">,</span> <span class="n">uVEM</span><span class="p">,</span> <span class="n">plotopts1</span><span class="p">{:});</span> <span class="n">colorbar</span><span class="p">();</span> <span class="n">axis</span> <span class="n">tight</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/example_2D_layers_02.png" src="mrst/vemmech/examples/html/example_2D_layers_02.png" />
</div>
</div>
</div>
<div class="section" id="example-of-poro-elastic-problem">
<h3>Example of poro-elastic problem<a class="headerlink" href="#example-of-poro-elastic-problem" title="Permalink to this headline"></a></h3>
<p><em>Generated from example_poroelasticity.m</em></p>
<p>This example sets up a poro-elastic problem which mimics a slice of the overburden, with an infinite horizontal well in an aquifer at the bottom of the domain. The poro-elastic equations are set up together with linear explicitely. At the end we simulate the same case by using the poro-elastic solver and compare with the results predicted by linear elasticity.
More examples can be generated by modifying the parameters sent to the function squareTest.m,</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">mrstModule</span> <span class="n">add</span> <span class="n">incomp</span> <span class="n">vemmech</span>
</pre></div>
</div>
<div class="section" id="define-the-grid-and-rock-parameters">
<h4>Define the grid and rock parameters<a class="headerlink" href="#define-the-grid-and-rock-parameters" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">opt</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span> <span class="s">&#39;L&#39;</span>         <span class="p">,</span> <span class="p">[</span><span class="mi">10000</span> <span class="mi">2000</span><span class="p">],</span> <span class="c">...</span>
              <span class="s">&#39;cartDims&#39;</span>  <span class="p">,</span> <span class="p">[</span><span class="mi">20</span> <span class="mi">20</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="p">,</span>    <span class="c">...</span>
              <span class="s">&#39;grid_type&#39;</span> <span class="p">,</span> <span class="s">&#39;square&#39;</span><span class="p">,</span>     <span class="c">...</span>
              <span class="s">&#39;disturb&#39;</span>   <span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>          <span class="c">...</span>
<span class="c">% Parameter for disturbing grid</span>
              <span class="s">&#39;E&#39;</span>         <span class="p">,</span> <span class="mf">1e9</span><span class="p">,</span>          <span class="c">...</span>
<span class="c">% Young&#39;s modulus</span>
              <span class="s">&#39;nu&#39;</span>        <span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>             <span class="c">% Poisson&#39;s ratio</span>


<span class="n">G</span> <span class="p">=</span> <span class="n">cartGrid</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">cartDims</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">L</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">disturb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">G</span> <span class="p">=</span> <span class="n">twister</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">disturb</span><span class="p">);</span>
<span class="k">end</span>
<span class="n">G</span> <span class="p">=</span> <span class="n">createAugmentedGrid</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
<span class="n">G</span> <span class="p">=</span> <span class="n">computeGeometry</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>

<span class="n">Ev</span>  <span class="p">=</span> <span class="nb">repmat</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">nuv</span> <span class="p">=</span> <span class="nb">repmat</span><span class="p">(</span><span class="n">opt</span><span class="p">.</span><span class="n">nu</span><span class="p">,</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">C</span>   <span class="p">=</span> <span class="n">Enu2C</span><span class="p">(</span><span class="n">Ev</span><span class="p">,</span> <span class="n">nuv</span><span class="p">,</span> <span class="n">G</span><span class="p">);</span>

<span class="n">figure</span><span class="p">()</span>
<span class="n">clf</span><span class="p">,</span>
<span class="n">plotGrid</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/example_poroelasticity_01.png" src="mrst/vemmech/examples/html/example_poroelasticity_01.png" />
</div>
</div>
<div class="section" id="set-up-gravity-as-the-loading-term">
<h4>Set up gravity as the loading term<a class="headerlink" href="#set-up-gravity-as-the-loading-term" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">gravity</span> <span class="n">reset</span> <span class="n">on</span>
<span class="n">density</span> <span class="p">=</span> <span class="mi">3000</span><span class="p">;</span> <span class="c">% in kg/m^3</span>
<span class="n">grav</span>    <span class="p">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">gravity</span><span class="p">());</span>   <span class="c">% gravity</span>
<span class="n">load</span>    <span class="p">=</span> <span class="p">@(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span><span class="p">(</span><span class="n">grav</span><span class="o">*</span><span class="n">density</span><span class="p">)</span><span class="o">*</span><span class="nb">repmat</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up-the-displacement-boundary-conditions">
<h4>Set up the displacement boundary conditions<a class="headerlink" href="#set-up-the-displacement-boundary-conditions" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">oside</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;Left&#39;</span><span class="p">,</span> <span class="s">&#39;Right&#39;</span><span class="p">,</span> <span class="s">&#39;Back&#39;</span><span class="p">,</span> <span class="s">&#39;Front&#39;</span><span class="p">};</span>
<span class="n">bc</span> <span class="p">=</span> <span class="n">cell</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="nb">numel</span><span class="p">(</span><span class="n">oside</span><span class="p">);</span>
    <span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">}</span> <span class="p">=</span> <span class="n">pside</span><span class="p">([],</span> <span class="n">G</span><span class="p">,</span> <span class="n">oside</span><span class="p">{</span><span class="nb">i</span><span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">}</span> <span class="p">=</span> <span class="n">rmfield</span><span class="p">(</span><span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">},</span> <span class="s">&#39;type&#39;</span><span class="p">);</span>
    <span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">}</span> <span class="p">=</span> <span class="n">rmfield</span><span class="p">(</span><span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">},</span> <span class="s">&#39;sat&#39;</span><span class="p">);</span>
<span class="k">end</span>
<span class="c">% Find the nodes for the different sides and set the boundaray conditions for</span>
<span class="c">% elastisity.</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">4</span>
    <span class="n">inodes</span> <span class="p">=</span> <span class="n">mcolon</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">nodePos</span><span class="p">(</span><span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">}.</span><span class="n">face</span><span class="p">),</span> <span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">nodePos</span><span class="p">(</span><span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">}.</span><span class="n">face</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">nodes</span> <span class="p">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">inodes</span><span class="p">));</span>
    <span class="n">disp_bc</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;nodes&#39;</span>   <span class="p">,</span> <span class="n">nodes</span><span class="p">,</span>      <span class="c">...</span>
                     <span class="s">&#39;uu&#39;</span>      <span class="p">,</span> <span class="mi">0</span><span class="p">,</span>          <span class="c">...</span>
                     <span class="s">&#39;faces&#39;</span>   <span class="p">,</span> <span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">}.</span><span class="n">face</span><span class="p">,</span> <span class="c">...</span>
                     <span class="s">&#39;uu_face&#39;</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span>          <span class="c">...</span>
                     <span class="s">&#39;mask&#39;</span>    <span class="p">,</span> <span class="n">true</span><span class="p">(</span><span class="nb">numel</span><span class="p">(</span><span class="n">nodes</span><span class="p">),</span> <span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="p">));</span>
    <span class="n">bc</span><span class="p">{</span><span class="nb">i</span><span class="p">}.</span><span class="n">el_bc</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;disp_bc&#39;</span><span class="p">,</span> <span class="n">disp_bc</span><span class="p">,</span> <span class="s">&#39;force_bc&#39;</span><span class="p">,</span> <span class="p">[]);</span>
<span class="k">end</span>
<span class="n">bcdisp</span> <span class="p">=</span> <span class="p">@(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">*</span><span class="mf">0.0</span><span class="p">;</span> <span class="c">% Boundary displacement function set to zero.</span>
<span class="c">% Setup diriclet boundary conditions at selected sides</span>
<span class="c">%</span>
<span class="c">% On the left and right-hand sides, zero displacement is imposed in the x</span>
<span class="c">% direction, and free in the y direction. This is done by using masks.</span>
<span class="n">bc_el_sides</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span> <span class="p">=</span> <span class="n">bc</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<span class="n">bc_el_sides</span><span class="p">{</span><span class="mi">1</span><span class="p">}.</span><span class="n">el_bc</span><span class="p">.</span><span class="n">disp_bc</span><span class="p">.</span><span class="n">mask</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">bc_el_sides</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span> <span class="p">=</span> <span class="n">bc</span><span class="p">{</span><span class="mi">2</span><span class="p">};</span>
<span class="n">bc_el_sides</span><span class="p">{</span><span class="mi">2</span><span class="p">}.</span><span class="n">el_bc</span><span class="p">.</span><span class="n">disp_bc</span><span class="p">.</span><span class="n">mask</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
<span class="c">% Zero displacement is imposed in the y direction at the bottom, free</span>
<span class="c">% displacement at the top.</span>
<span class="n">bc_el_sides</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span> <span class="p">=</span> <span class="n">bc</span><span class="p">{</span><span class="mi">3</span><span class="p">};</span>
<span class="n">bc_el_sides</span><span class="p">{</span><span class="mi">3</span><span class="p">}.</span><span class="n">el_bc</span><span class="p">.</span><span class="n">disp_bc</span><span class="p">.</span><span class="n">mask</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">bc_el_sides</span><span class="p">{</span><span class="mi">4</span><span class="p">}</span> <span class="p">=</span> <span class="p">[];</span>

<span class="c">% Collect the displacement boundary conditions</span>
<span class="n">nodes</span> <span class="p">=</span> <span class="p">[];</span>
<span class="n">faces</span> <span class="p">=</span> <span class="p">[];</span>
<span class="n">mask</span> <span class="p">=</span> <span class="p">[];</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="nb">numel</span><span class="p">(</span><span class="n">bc</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">bc_el_sides</span><span class="p">{</span><span class="nb">i</span><span class="p">}))</span>
        <span class="n">nodes</span> <span class="p">=</span> <span class="p">[</span><span class="n">nodes</span><span class="p">;</span> <span class="n">bc_el_sides</span><span class="p">{</span><span class="nb">i</span><span class="p">}.</span><span class="n">el_bc</span><span class="p">.</span><span class="n">disp_bc</span><span class="p">.</span><span class="n">nodes</span><span class="p">];</span> <span class="c">%#ok</span>
        <span class="n">faces</span> <span class="p">=</span> <span class="p">[</span><span class="n">faces</span><span class="p">;</span> <span class="n">bc_el_sides</span><span class="p">{</span><span class="nb">i</span><span class="p">}.</span><span class="n">el_bc</span><span class="p">.</span><span class="n">disp_bc</span><span class="p">.</span><span class="n">faces</span><span class="p">];</span> <span class="c">%#ok</span>
        <span class="n">mask</span>  <span class="p">=</span> <span class="p">[</span><span class="n">mask</span><span class="p">;</span> <span class="n">bc_el_sides</span><span class="p">{</span><span class="nb">i</span><span class="p">}.</span><span class="n">el_bc</span><span class="p">.</span><span class="n">disp_bc</span><span class="p">.</span><span class="n">mask</span><span class="p">];</span> <span class="c">%#ok</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">disp_node</span> <span class="p">=</span> <span class="n">bcdisp</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">nodes</span><span class="p">.</span><span class="n">coords</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="p">:));</span>
<span class="n">disp_faces</span> <span class="p">=</span> <span class="n">bcdisp</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">centroids</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="p">:));</span>
<span class="n">disp_bc</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;nodes&#39;</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="s">&#39;uu&#39;</span><span class="p">,</span> <span class="n">disp_node</span><span class="p">,</span> <span class="s">&#39;faces&#39;</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="s">&#39;uu_face&#39;</span><span class="p">,</span> <span class="n">disp_faces</span><span class="p">,</span> <span class="s">&#39;mask&#39;</span><span class="p">,</span> <span class="n">mask</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h4>Set up the force boundary conditions<a class="headerlink" href="#id10" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% A force is applied on the top surface.</span>
<span class="n">sigma</span> <span class="p">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">L</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">;</span>
<span class="n">force</span> <span class="p">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">barsa</span><span class="p">;</span>
<span class="n">face_force</span> <span class="p">=</span> <span class="p">@(</span><span class="n">x</span><span class="p">)</span> <span class="n">force</span><span class="o">*</span><span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(((</span><span class="n">x</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">opt</span><span class="p">.</span><span class="n">L</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">./</span><span class="n">sigma</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="o">*</span><span class="n">barsa</span><span class="p">;</span>
<span class="n">faces</span> <span class="p">=</span> <span class="n">bc</span><span class="p">{</span><span class="mi">4</span><span class="p">}.</span><span class="n">face</span><span class="p">;</span>
<span class="c">% Set up the force boundary structure</span>
<span class="c">% Note that the unit for the force is in units Pa/m^3</span>
<span class="n">force_bc</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;faces&#39;</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="s">&#39;force&#39;</span><span class="p">,</span> <span class="nb">bsxfun</span><span class="p">(@</span><span class="n">times</span><span class="p">,</span> <span class="n">face_force</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">centroids</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="p">:)),</span> <span class="p">[</span><span class="mi">0</span> <span class="o">-</span><span class="mi">1</span><span class="p">]));</span>


<span class="c">% Final structure for the  boundary conditions</span>
<span class="n">el_bc</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;disp_bc&#39;</span><span class="p">,</span> <span class="n">disp_bc</span><span class="p">,</span> <span class="s">&#39;force_bc&#39;</span><span class="p">,</span> <span class="n">force_bc</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h4>Assemble and solve the system<a class="headerlink" href="#id11" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">uu</span><span class="p">,</span> <span class="n">extra</span><span class="p">]</span> <span class="p">=</span> <span class="n">VEM_linElast</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">el_bc</span><span class="p">,</span> <span class="n">load</span><span class="p">);</span>

<span class="c">% We retrieve the discrete operators that have been assembled</span>
<span class="n">As</span>        <span class="p">=</span> <span class="n">extra</span><span class="p">.</span><span class="n">disc</span><span class="p">.</span><span class="n">A</span><span class="p">;</span>     <span class="c">% Global stiffness matrix</span>
<span class="n">div</span>       <span class="p">=</span> <span class="n">extra</span><span class="p">.</span><span class="n">disc</span><span class="p">.</span><span class="n">div</span><span class="p">;</span>   <span class="c">% Divergence operator</span>
<span class="n">gradP</span>     <span class="p">=</span> <span class="n">extra</span><span class="p">.</span><span class="n">disc</span><span class="p">.</span><span class="n">gradP</span><span class="p">;</span> <span class="c">% Gradient operator (dual of div)</span>
<span class="n">isdirdofs</span> <span class="p">=</span> <span class="n">extra</span><span class="p">.</span><span class="n">disc</span><span class="p">.</span><span class="n">isdirdofs</span><span class="p">;</span> <span class="c">% Degrees of freedom where in fact</span>
                                  <span class="c">% Dirichlet boundary conditions are imposed.</span>
<span class="n">rhs_s</span>     <span class="p">=</span> <span class="n">extra</span><span class="p">.</span><span class="n">disc</span><span class="p">.</span><span class="n">rhs</span><span class="p">;</span>   <span class="c">% Right-hand side</span>
<span class="n">Vdir</span>      <span class="p">=</span> <span class="n">extra</span><span class="p">.</span><span class="n">disc</span><span class="p">.</span><span class="n">V_dir</span><span class="p">;</span> <span class="c">%</span>
<span class="n">ind_s</span>     <span class="p">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="nb">size</span><span class="p">(</span><span class="n">As</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span><span class="o">&#39;</span><span class="p">;</span><span class="c">%#ok</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up-the-parameters-for-the-flow-part">
<h4>Set up the parameters for the flow part<a class="headerlink" href="#set-up-the-parameters-for-the-flow-part" title="Permalink to this headline"></a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">perm</span> <span class="p">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">darcy</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">cartDims</span><span class="p">);</span>
<span class="n">perm</span><span class="p">(:,</span> <span class="nb">floor</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">cartDims</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span> <span class="p">:</span> <span class="k">end</span><span class="p">)</span> <span class="p">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">milli</span><span class="o">*</span><span class="n">darcy</span><span class="p">;</span>
<span class="n">rock</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;perm&#39;</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">perm</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">),</span>     <span class="c">...</span>
              <span class="s">&#39;poro&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="c">...</span>
              <span class="s">&#39;alpha&#39;</span><span class="p">,</span> <span class="nb">ones</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span> <span class="c">% Rock parameters</span>
<span class="n">fluid</span> <span class="p">=</span> <span class="n">initSingleFluid</span><span class="p">(</span><span class="s">&#39;mu&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">centi</span><span class="o">*</span><span class="n">poise</span><span class="p">,</span> <span class="s">&#39;rho&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span> <span class="c">% Fluid parameters</span>
<span class="n">rock</span><span class="p">.</span><span class="n">cr</span> <span class="p">=</span> <span class="mf">1e-4</span><span class="o">/</span><span class="n">barsa</span><span class="p">;</span> <span class="c">% Fluid compressibility</span>
<span class="n">T</span> <span class="p">=</span> <span class="n">computeTrans</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">rock</span><span class="p">);</span> <span class="c">% Compute the transmissibilities</span>
<span class="n">pv</span> <span class="p">=</span> <span class="n">poreVolume</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">rock</span><span class="p">);</span> <span class="c">% Compute the pore volume</span>
<span class="n">pressure</span> <span class="p">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">barsa</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c">% Initial pressure</span>
<span class="c">% Set up the initial state for the flow.</span>
<span class="n">state</span> <span class="p">=</span> <span class="n">struct</span><span class="p">(</span><span class="s">&#39;pressure&#39;</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="nb">ones</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s">&#39;flux&#39;</span><span class="p">,</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">faces</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
<span class="c">% Set up a well structure for the fluid injection and also boundary</span>
<span class="c">% conditions for the flow.</span>
<span class="n">mcoord</span> <span class="p">=</span> <span class="p">[</span><span class="mi">5000</span> <span class="mi">200</span><span class="p">];</span>
<span class="p">[</span><span class="n">dd</span><span class="p">,</span> <span class="n">wc</span><span class="p">]</span> <span class="p">=</span> <span class="n">min</span><span class="p">(</span><span class="n">sum</span><span class="p">(</span><span class="nb">bsxfun</span><span class="p">(@</span><span class="n">minus</span><span class="p">,</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">centroids</span><span class="p">,</span> <span class="n">mcoord</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
<span class="n">W</span> <span class="p">=</span> <span class="n">addWell</span><span class="p">([],</span> <span class="n">G</span><span class="p">,</span> <span class="n">rock</span><span class="p">,</span> <span class="n">wc</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;bhp&#39;</span><span class="p">,</span> <span class="s">&#39;val&#39;</span><span class="p">,</span> <span class="mi">3000</span><span class="o">*</span><span class="n">barsa</span><span class="p">);</span>
<span class="n">bc_f</span> <span class="p">=</span> <span class="n">pside</span><span class="p">([],</span> <span class="n">G</span><span class="p">,</span> <span class="s">&#39;Front&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">barsa</span><span class="p">);</span>
<span class="n">fbc</span> <span class="p">=</span> <span class="n">addFluidContribMechVEM</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">bc_f</span><span class="p">,</span> <span class="n">rock</span><span class="p">,</span> <span class="n">isdirdofs</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up-matrix-for-mechanics-and-flow">
<h4>Set up matrix for mechanics and flow<a class="headerlink" href="#set-up-matrix-for-mechanics-and-flow" title="Permalink to this headline"></a></h4>
<p>Use a TPFA solver for weakly compressible flow. From the output we retrieve the operators for the fluid.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span> <span class="p">=</span> <span class="n">day</span><span class="p">;</span> <span class="c">% time step.</span>
<span class="n">state</span> <span class="p">=</span> <span class="n">lincompTPFA</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">pv</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">rock</span><span class="p">,</span> <span class="s">&#39;MatrixOutput&#39;</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="s">&#39;wells&#39;</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="s">&#39;bc&#39;</span><span class="p">,</span> <span class="n">bc_f</span><span class="p">);</span>

<span class="n">Af</span>    <span class="p">=</span> <span class="n">state</span><span class="p">.</span><span class="n">A</span><span class="p">;</span>   <span class="c">% Global matrix for the flow solver</span>
<span class="n">orhsf</span> <span class="p">=</span> <span class="n">state</span><span class="p">.</span><span class="n">rhs</span><span class="p">;</span> <span class="c">% Right-hand side for the flow equations (includes well)</span>
<span class="n">ct</span>    <span class="p">=</span> <span class="n">state</span><span class="p">.</span><span class="n">ct</span><span class="p">;</span>  <span class="c">% Compressibility coefficient</span>
<span class="n">ind_f</span> <span class="p">=</span> <span class="p">[</span><span class="n">ind_s</span><span class="p">(</span><span class="k">end</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">ind_s</span><span class="p">(</span><span class="k">end</span><span class="p">)</span> <span class="o">+</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">]</span><span class="o">&#39;</span><span class="p">;</span><span class="c">%#ok</span>

<span class="c">% x denotes the global unknown (displacement + pressure)</span>
<span class="n">x</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">ind_f</span><span class="p">(</span><span class="k">end</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">x</span><span class="p">(</span><span class="n">ind_f</span><span class="p">)</span> <span class="p">=</span> <span class="n">pressure</span><span class="p">;</span>
<span class="n">p</span> <span class="p">=</span> <span class="n">pressure</span><span class="p">;</span>

<span class="n">uu0</span> <span class="p">=</span> <span class="n">uu</span><span class="p">;</span>            <span class="c">% Solution from linear elasticity</span>
<span class="n">u_tmp</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">uu</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">x</span><span class="p">(</span><span class="mi">1</span> <span class="p">:</span> <span class="n">ind_s</span><span class="p">(</span><span class="k">end</span><span class="p">))</span> <span class="p">=</span> <span class="n">u_tmp</span><span class="p">(</span><span class="o">~</span><span class="n">isdirdofs</span><span class="p">);</span>
<span class="n">u</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">numel</span><span class="p">(</span><span class="n">isdirdofs</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">rhsf</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">orhsf</span><span class="p">));</span>
<span class="n">plotops</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;EdgeColor&#39;</span><span class="p">,</span> <span class="s">&#39;none&#39;</span><span class="p">};</span>
<span class="n">fac</span> <span class="p">=</span> <span class="n">rock</span><span class="p">.</span><span class="n">poro</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c">% Assemble the matrix for the global system, mechanics + flow</span>
<span class="n">zeromat</span> <span class="p">=</span> <span class="n">sparse</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">Af</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="nb">size</span><span class="p">(</span><span class="n">div</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
<span class="n">SS</span> <span class="p">=</span> <span class="p">[</span><span class="n">As</span><span class="p">,</span> <span class="p">[</span><span class="n">fac</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">gradP</span><span class="p">),</span> <span class="n">zeromat</span><span class="o">&#39;</span><span class="p">];</span> <span class="p">[</span><span class="n">fac</span><span class="o">*</span><span class="n">div</span><span class="p">;</span> <span class="n">zeromat</span><span class="p">],</span> <span class="n">ct</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">Af</span><span class="p">];</span>
</pre></div>
</div>
</div>
<div class="section" id="time-loop">
<h4>Time loop<a class="headerlink" href="#time-loop" title="Permalink to this headline"></a></h4>
<p>Set up bigger figures</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="p">=</span> <span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;DefaultFigurePosition&#39;</span><span class="p">);</span>
<span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.*</span><span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span> <span class="n">clf</span>
<span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="n">set</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;Position&#39;</span><span class="p">,</span> <span class="n">df</span><span class="o">.*</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span> <span class="n">clf</span>

<span class="n">t</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">end_time</span> <span class="p">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>
<span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">end_time</span>
    <span class="n">t</span> <span class="p">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="p">;</span>
    <span class="c">% We update the right-hand side for the fluid (divergence term comes</span>
    <span class="c">% from mechanics).</span>
    <span class="n">rhsf</span><span class="p">(</span><span class="mi">1</span> <span class="p">:</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">)</span> <span class="p">=</span> <span class="n">orhsf</span><span class="p">(</span><span class="mi">1</span> <span class="p">:</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="n">ct</span><span class="p">(</span><span class="mi">1</span> <span class="p">:</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span><span class="p">)</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="n">fac</span><span class="o">*</span><span class="n">div</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">ind_s</span><span class="p">);</span>
    <span class="n">rhsf</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="k">end</span><span class="p">)</span> <span class="p">=</span> <span class="n">orhsf</span><span class="p">(</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">num</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="k">end</span><span class="p">);</span>
    <span class="n">rhs</span> <span class="p">=</span> <span class="p">[</span><span class="n">rhs_s</span> <span class="o">-</span> <span class="n">fbc</span><span class="p">;</span> <span class="n">rhsf</span><span class="p">];</span>

    <span class="c">% Solve the system</span>
    <span class="n">x</span> <span class="p">=</span> <span class="n">SS</span><span class="o">\</span><span class="n">rhs</span><span class="p">;</span>

    <span class="c">% Retrieve pressure and displacement</span>
    <span class="n">p</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="n">ind_f</span><span class="p">);</span> <span class="c">% retrieve pressure</span>
    <span class="n">u</span><span class="p">(</span><span class="n">isdirdofs</span><span class="p">)</span> <span class="p">=</span> <span class="n">Vdir</span><span class="p">(</span><span class="n">isdirdofs</span><span class="p">);</span>
    <span class="n">u</span><span class="p">(</span><span class="o">~</span><span class="n">isdirdofs</span><span class="p">)</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="n">ind_s</span><span class="p">);</span> <span class="c">% retrieve displacement</span>
    <span class="n">uu</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">G</span><span class="p">.</span><span class="n">griddim</span><span class="p">,</span> <span class="p">[])</span><span class="o">&#39;</span><span class="p">;</span>

    <span class="c">% Plot absolute results from poromechanics</span>
    <span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cla</span>
    <span class="n">plotNodeData</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">uu</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">plotops</span><span class="p">{</span> <span class="p">:</span> <span class="p">});</span> <span class="n">colorbar</span><span class="p">;</span>
    <span class="n">title</span><span class="p">(</span><span class="s">&#39;Displacement in x direction&#39;</span><span class="p">)</span>
    <span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">cla</span>
    <span class="n">plotNodeData</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">uu</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">plotops</span><span class="p">{</span> <span class="p">:</span> <span class="p">});</span> <span class="n">colorbar</span><span class="p">;</span>
    <span class="n">title</span><span class="p">(</span><span class="s">&#39;Displacement in y direction&#39;</span><span class="p">)</span>
    <span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">cla</span>
    <span class="n">plotCellDataDeformed</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">p</span><span class="o">/</span><span class="n">barsa</span><span class="p">,</span> <span class="n">uu</span><span class="p">);</span> <span class="n">colorbar</span><span class="p">;</span>
    <span class="n">title</span><span class="p">(</span><span class="s">&#39;Pressure&#39;</span><span class="p">)</span>
    <span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">cla</span>
    <span class="n">ovdiv</span> <span class="p">=</span> <span class="n">extra</span><span class="p">.</span><span class="n">disc</span><span class="p">.</span><span class="n">ovol_div</span><span class="p">;</span>
    <span class="n">mdiv</span> <span class="p">=</span> <span class="n">ovdiv</span><span class="o">*</span><span class="nb">reshape</span><span class="p">(</span><span class="n">uu</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">)</span><span class="o">./</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">volumes</span><span class="p">;</span>
    <span class="n">plotCellDataDeformed</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">mdiv</span><span class="p">,</span> <span class="n">uu</span><span class="p">);</span> <span class="n">colorbar</span><span class="p">();</span>
    <span class="n">title</span><span class="p">(</span><span class="s">&#39;Divergence&#39;</span><span class="p">)</span>

    <span class="c">% Plot difference from results predicted by linear elasticity</span>
    <span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">uur</span> <span class="p">=</span> <span class="n">uu</span> <span class="o">-</span> <span class="n">uu0</span><span class="p">;</span>
    <span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cla</span>
    <span class="n">plotNodeData</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">uur</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">plotops</span><span class="p">{</span> <span class="p">:</span> <span class="p">});</span> <span class="n">colorbar</span><span class="p">;</span>
    <span class="n">title</span><span class="p">(</span><span class="s">&#39;Relative displacement in x direction&#39;</span><span class="p">)</span>
    <span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">cla</span>
    <span class="n">plotNodeData</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">uur</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">plotops</span><span class="p">{</span> <span class="p">:</span> <span class="p">});</span> <span class="n">colorbar</span><span class="p">;</span>
    <span class="n">title</span><span class="p">(</span><span class="s">&#39;Relative displacement in y direction&#39;</span><span class="p">)</span>
    <span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">cla</span>
    <span class="n">plotCellDataDeformed</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">p</span><span class="o">/</span><span class="n">barsa</span><span class="p">,</span> <span class="n">uur</span><span class="p">);</span> <span class="n">colorbar</span><span class="p">;</span>
    <span class="n">title</span><span class="p">(</span><span class="s">&#39;Pressure (grid deformed using relative disp.)&#39;</span><span class="p">)</span>
    <span class="n">axis</span> <span class="n">tight</span>
    <span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">cla</span>
    <span class="n">ovdiv</span> <span class="p">=</span> <span class="n">extra</span><span class="p">.</span><span class="n">disc</span><span class="p">.</span><span class="n">ovol_div</span><span class="p">;</span>
    <span class="n">mdiv</span> <span class="p">=</span> <span class="n">ovdiv</span><span class="o">*</span><span class="nb">reshape</span><span class="p">(</span><span class="n">uur</span><span class="o">&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">)</span><span class="o">./</span><span class="n">G</span><span class="p">.</span><span class="n">cells</span><span class="p">.</span><span class="n">volumes</span><span class="p">;</span>
    <span class="n">plotCellDataDeformed</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">mdiv</span><span class="p">,</span> <span class="n">uu</span><span class="p">);</span> <span class="n">colorbar</span><span class="p">();</span>
    <span class="n">title</span><span class="p">(</span><span class="s">&#39;Divergence of relative displacement&#39;</span><span class="p">)</span>
    <span class="n">axis</span> <span class="n">tight</span>
    <span class="c">%pause(0.01);</span>

<span class="k">end</span>
</pre></div>
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/example_poroelasticity_02.png" src="mrst/vemmech/examples/html/example_poroelasticity_02.png" />
</div>
<div class="figure align-default" style="width: 100%">
<img alt="mrst/vemmech/examples/html/example_poroelasticity_03.png" src="mrst/vemmech/examples/html/example_poroelasticity_03.png" />
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="vem.html" class="btn btn-neutral float-left" title="vem: Virtual element method on general grids" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="wellpaths.html" class="btn btn-neutral float-right" title="wellpaths: Generation of wells using general curves" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, SINTEF Digital.
      <span class="lastupdated">Last updated on Sep 23, 2021.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>